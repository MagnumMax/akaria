<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AKARIA Portal - Interactive Prototype v5</title>

    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Chart.js via CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Custom Styles -->
    <link rel="stylesheet" href="styles.css">
    <script src="data.js"></script>

    <script src="data/deals.js"></script>
    <script src="data/properties.js"></script>
    <script src="data/icons.js"></script>
    <script src="data/tasks.js"></script>
    <script src="data/assistant.js"></script>

</head>

<body class="bg-white">

    <!-- Login Page -->
    <div id="login-page"
        class="min-h-screen flex items-center justify-center bg-gradient-to-br from-gray-50 to-gray-100 px-4 sm:px-6 lg:px-8 transition-opacity duration-500">
        <div
            class="max-w-md w-full space-y-8 bg-white/80 backdrop-blur-xl p-10 rounded-3xl shadow-2xl border border-white/40 ring-1 ring-black/5">
            <div class="text-center">
                <div
                    class="mx-auto h-16 w-16 bg-gradient-to-tr from-blue-600 to-blue-400 rounded-2xl flex items-center justify-center mb-6 shadow-lg shadow-blue-500/20 transform rotate-3 hover:rotate-6 transition-transform duration-300">
                    <svg class="h-8 w-8 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2">
                        <path d="M12 3L2 9l10 6 10-6-10-6z" />
                        <path d="M2 9l10 6 10-6" />
                        <path d="M2 15l10 6 10-6" />
                    </svg>
                </div>
                <h2 class="mt-6 text-3xl font-extrabold text-gray-900 tracking-tight">AKARIA Portal</h2>
                <p class="mt-2 text-sm text-gray-600">Log in to the management system</p>
            </div>
            <form class="mt-8 space-y-6" id="login-form">
                <div class="rounded-xl shadow-sm -space-y-px bg-white">
                    <div class="mb-4">
                        <label for="role-select" class="block text-sm font-medium text-gray-700 mb-1 pl-1">Select
                            Role</label>
                        <div class="relative">
                            <select id="role-select" name="role"
                                class="appearance-none rounded-lg relative block w-full px-4 py-3 border border-gray-200 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent focus:z-10 sm:text-sm transition-shadow bg-gray-50/50 hover:bg-white">
                                <option value="CEO">CEO</option>
                                <option value="Agent">Agent</option>
                                <option value="Admin">Admin</option>
                            </select>
                            <div
                                class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-gray-500">
                                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </div>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label for="email-address" class="block text-sm font-medium text-gray-700 mb-1 pl-1">Email
                            Address</label>
                        <input id="email-address" name="email" type="email" autocomplete="email" required
                            class="appearance-none rounded-lg relative block w-full px-4 py-3 border border-gray-200 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent focus:z-10 sm:text-sm transition-shadow bg-gray-50/50 hover:bg-white"
                            value="elena@akaria.com" readonly>
                    </div>
                    <div>
                        <label for="password" class="block text-sm font-medium text-gray-700 mb-1 pl-1">Password</label>
                        <input id="password" name="password" type="password" autocomplete="current-password" required
                            class="appearance-none rounded-lg relative block w-full px-4 py-3 border border-gray-200 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent focus:z-10 sm:text-sm transition-shadow bg-gray-50/50 hover:bg-white"
                            value="password123" readonly>
                    </div>
                </div>

                <div>
                    <button type="submit"
                        class="group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-bold rounded-xl text-white bg-gray-900 hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-900 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
                        <span class="absolute left-0 inset-y-0 flex items-center pl-3">
                            <svg class="h-5 w-5 text-gray-500 group-hover:text-gray-400 transition-colors"
                                xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
                                aria-hidden="true">
                                <path fill-rule="evenodd"
                                    d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z"
                                    clip-rule="evenodd" />
                            </svg>
                        </span>
                        Log In
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div id="app-container" class="hidden flex h-screen opacity-0 transition-opacity duration-500">

        <!-- Sidebar Navigation -->
        <div id="mobile-menu-backdrop" class="fixed inset-0 bg-black/50 z-30 hidden md:hidden glass-effect"></div>
        <nav id="sidebar"
            class="fixed inset-y-0 left-0 z-40 transform -translate-x-full md:translate-x-0 md:static md:flex flex-col w-64 flex-shrink-0 border-r border-border bg-white/80 backdrop-blur-xl supports-[backdrop-filter]:bg-white/60 transition-transform duration-300 shadow-xl md:shadow-none">
            <div class="flex items-center h-16 px-6 border-b border-border">
                <a href="#dashboard" class="flex items-center gap-2 font-semibold text-lg">
                    <svg class="h-6 w-6 text-accent" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2">
                        <path d="M12 3L2 9l10 6 10-6-10-6z" />
                        <path d="M2 9l10 6 10-6" />
                        <path d="M2 15l10 6 10-6" />
                    </svg>
                    <span class="tracking-tight">AKARIA Portal</span>
                </a>
                <button id="close-sidebar-btn" class="md:hidden ml-auto p-1 text-gray-500 hover:text-gray-900">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div id="sidebar-nav-links" class="flex-1 overflow-y-auto py-4 custom-scrollbar"></div>
        </nav>

        <!-- Main Content Area -->
        <div class="flex flex-col flex-1">
            <header
                class="flex items-center h-16 px-4 md:px-6 border-b border-border bg-white/80 backdrop-blur-md sticky top-0 z-20 shadow-sm">
                <button class="md:hidden mr-4 p-2 text-gray-600 hover:text-gray-800" id="mobile-menu-btn">
                    <svg class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="3" y1="12" x2="21" y2="12" />
                        <line x1="3" y1="6" x2="21" y2="6" />
                        <line x1="3" y1="18" x2="21" y2="18" />
                    </svg>
                </button>
                <div class="flex-1">
                    <h1 id="page-title" class="text-xl font-semibold">Dashboard</h1>
                </div>
                <div class="flex items-center gap-4">
                    <button class="p-2 transition-colors text-gray-600 hover:text-gray-800" title="Open Assistant Chat"
                        id="assistant-chat-btn">
                        <svg class="h-5 w-5 text-accent" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
                            <path d="M8 10h.01M12 10h.01M16 10h.01" />
                        </svg>
                    </button>
                    <div class="relative">
                        <button class="flex items-center gap-2 text-gray-600 hover:text-gray-800" id="user-menu-btn">
                            <img src="https://i.pravatar.cc/150?u=ceo" id="user-avatar" class="h-8 w-8 rounded-full"
                                alt="User Avatar">
                            <div class="hidden md:block text-left">
                                <p id="user-name" class="text-sm font-medium">Elena Petrova</p>
                                <p id="user-role-display" class="text-xs text-muted-foreground">CEO</p>
                            </div>
                        </button>
                    </div>
                </div>
            </header>

            <main id="main-content" class="flex-1 overflow-y-auto bg-muted/40 scroll-smooth">
                <div id="page-content-wrapper" class="p-4 md:p-6">
                    <section id="page-dashboard" class="page-hidden"></section>

                    <section id="page-deals" class="page-hidden"></section>
                    <section id="page-deal-details" class="page-hidden"></section>
                    <section id="page-properties" class="page-hidden"></section>
                    <section id="page-property-details" class="page-hidden"></section>
                    <section id="page-tasks" class="page-hidden"></section>

                    <section id="page-settings" class="page-hidden"></section>
                    <section id="page-imports" class="page-hidden"></section>
                    <section id="page-my-assistant" class="page-hidden"></section>
                    <section id="page-my-assistant-settings" class="page-hidden"></section>

                </div>
            </main>
        </div>
    </div>

    <!-- Floating Role Switcher (Hidden by default, can be removed or kept for dev debug) -->
    <div id="role-switcher"
        class="hidden fixed bottom-4 right-4 bg-white border border-border shadow-lg rounded-lg p-2 flex flex-col gap-2 z-50">
        <button
            class="role-btn text-xs px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            data-role="CEO">CEO</button>
        <button
            class="role-btn text-xs px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            data-role="Agent">Agent</button>
        <button
            class="role-btn text-xs px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            data-role="Admin">Admin</button>
    </div>

    <!-- Mini-Landing Page Offer (Separate view) -->
    <div id="page-offer" class="page-hidden fixed inset-0 bg-white z-[100] overflow-y-auto"></div>

    <!-- Modal Container -->
    <div id="modal-container" data-state="closed"
        class="fixed inset-0 bg-black/60 z-[100] items-center justify-center p-4">
        <div id="modal-content" class="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center p-4 border-b">
                <h3 id="modal-title" class="font-semibold">Modal Title</h3><button
                    class="p-1 rounded-full hover:bg-gray-100 text-gray-600 hover:text-gray-800"
                    id="modal-close-btn">&times;</button>
            </div>
            <div id="modal-body" class="p-6 overflow-y-auto"></div>
        </div>
    </div>


    <script>
        // ===================================================================================
        // SCRIPT: AKARIA Portal Interactive Prototype
        // ===================================================================================

        document.addEventListener('DOMContentLoaded', () => {

            // -----------------------------------------------------------------------------
            // 1. STATE MANAGEMENT
            // -----------------------------------------------------------------------------

            let state = { currentUserRole: 'CEO', currentPage: 'dashboard', unassignedLeads: 5, dealsViewMode: 'kanban', dealsFilter: { search: '', agent: 'All', showAiStages: true } };
            window.state = state;

            // -----------------------------------------------------------------------------
            // 2. NAVIGATION & ROUTING
            // -----------------------------------------------------------------------------



            // Data is loaded from separate modules via data-loader.js

            const ICONS = {
                dashboard: `<svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 3L2 9l10 6 10-6-10-6z"/><path d="M2 9l10 6 10-6"/><path d="M2 15l10 6 10-6"/></svg>`,
                assistant: `<svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 8V4H8"/><rect x="4" y="4" width="16" height="16" rx="2"/><path d="M2 14h2m16 0h2M15 2v2M9 2v2"/></svg>`,
                deals: `<svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><line x1="3" y1="9" x2="21" y2="9"/></svg>`,
                properties: `<svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 21h12v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2z"/><path d="M14 10a4 4 0 0 1 4-4h2a2 2 0 0 1 2 2v2a4 4 0 0 1-4 4h-2a2 2 0 0 1-2-2v-2zM8 9V7a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2"/><line x1="12" y1="13" x2="12" y2="15"/></svg>`,
                tasks: `<svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/><path d="m9 14 2 2 4-4"/></svg>`,

                settings: `<svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>`,
                imports: `<svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>`,
                contacts: `<svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>`,
                bot: `<span class="text-lg">‚ú®</span>`,
                anomaly: `<svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 13.5l10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75z" /></svg>`,
                chevron: `<svg class="h-4 w-4 transition-transform" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>`
            };













            // -----------------------------------------------------------------------------
            // 2. NAVIGATION & ROUTING
            // -----------------------------------------------------------------------------

            const navLinks = {
                CEO: [{ id: 'dashboard', name: 'Dashboard', icon: ICONS.dashboard }, { id: 'deals', name: 'Deals', icon: ICONS.deals }, { id: 'properties', name: 'Properties', icon: ICONS.properties }, { id: 'tasks', name: 'Tasks', icon: ICONS.tasks }, { id: 'settings', name: 'Settings', icon: ICONS.settings }, { type: 'divider' }, { id: 'my-assistant', name: 'My Assistant', icon: ICONS.assistant }],
                Agent: [{ id: 'dashboard', name: 'Dashboard', icon: ICONS.dashboard }, { id: 'tasks', name: 'My Tasks', icon: ICONS.tasks }, { id: 'deals', name: 'My Deals', icon: ICONS.deals }, { id: 'properties', name: 'Properties', icon: ICONS.properties }, { type: 'divider' }, { id: 'my-assistant', name: 'My Assistant', icon: ICONS.assistant }],
                Admin: [{ id: 'dashboard', name: 'Dashboard', icon: ICONS.dashboard }, { id: 'imports', name: 'Imports', icon: ICONS.imports }, { id: 'properties', name: 'Manage Properties', icon: ICONS.properties }, { id: 'settings', name: 'Settings', icon: ICONS.settings }]
            };

            function renderSidebar() {
                const links = navLinks[state.currentUserRole];
                const navContainer = document.getElementById('sidebar-nav-links');
                navContainer.innerHTML = `<nav class="grid items-start px-4 text-sm font-medium gap-1">${links.map(link => { if (link.type === 'divider') return '<hr class="my-4 border-border">'; const isAssistantLink = link.id === 'jessica' || link.id === 'leonardo'; const linkClasses = `nav-link flex items-center gap-3 rounded-lg px-3 py-2.5 text-muted-foreground transition-all hover:text-foreground hover:bg-muted/50 ${isAssistantLink ? 'text-accent font-semibold' : ''}`; return `<a href="#${link.id}" data-page="${link.id}" class="${linkClasses}">${link.icon}<span>${link.name}</span></a>`; }).join('')}</nav>`;
                updateActiveNavLink();
            }

            function updateActiveNavLink() {
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.remove('nav-active');
                    if (link.dataset.page === state.currentPage.split('-')[0]) {
                        link.classList.add('nav-active');
                    }
                });
            }

            function showPage(pageId, contextId = null) {
                document.querySelectorAll('#page-content-wrapper > section').forEach(page => page.classList.add('page-hidden'));

                const targetPage = document.getElementById(`page-${pageId}`);
                if (targetPage) {
                    targetPage.classList.remove('page-hidden');
                    state.currentPage = pageId;

                    const renderMap = { 'dashboard': renderDashboard, 'my-assistant': renderMyAssistantPage, 'my-assistant-settings': renderMyAssistantSettingsPage, 'deals': renderDealsPage, 'deal-details': () => renderDealDetailsPage(contextId), 'properties': renderPropertiesPage, 'property-details': () => renderPropertyDetailsPage(contextId), 'tasks': renderTasksPage, 'settings': renderSettingsPage, 'imports': renderImportsPage };
                    if (renderMap[pageId]) renderMap[pageId]();

                    const pageConfig = (navLinks[state.currentUserRole] || []).find(p => p.id === pageId);
                    document.getElementById('page-title').textContent = pageConfig ? pageConfig.name : pageId.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase());

                    updateActiveNavLink();
                } else {
                    showPage('dashboard');
                }
                document.getElementById('sidebar').classList.add('hidden');
            }

            function handleRouting() {
                let hash = window.location.hash.substring(1);
                if (hash.startsWith('offer/')) {
                    const token = hash.split('/')[1];
                    renderOfferPage(token);
                    document.getElementById('page-offer').classList.remove('page-hidden');
                    document.getElementById('app-container').classList.add('page-hidden');
                    document.getElementById('role-switcher').classList.add('page-hidden');
                    return;
                } else {
                    document.getElementById('page-offer').classList.add('page-hidden');
                    document.getElementById('app-container').classList.remove('page-hidden');
                    document.getElementById('role-switcher').classList.remove('page-hidden');
                }
                const [pageId, contextId] = hash.split('/');
                showPage(pageId || 'dashboard', contextId ? parseInt(contextId) : null);
            }

            // -----------------------------------------------------------------------------
            // 3. LOGIN LOGIC
            // -----------------------------------------------------------------------------

            function initLogin() {
                const loginForm = document.getElementById('login-form');
                const roleSelect = document.getElementById('role-select');
                const emailInput = document.getElementById('email-address');
                const passwordInput = document.getElementById('password');
                const loginPage = document.getElementById('login-page');
                const appContainer = document.getElementById('app-container');

                const credentials = {
                    'CEO': { email: 'elena@akaria.com', password: 'password123' },
                    'Agent': { email: 'agent@akaria.com', password: 'agentpassword' },
                    'Admin': { email: 'admin@akaria.com', password: 'adminsecure' }
                };

                roleSelect.addEventListener('change', (e) => {
                    const role = e.target.value;
                    if (credentials[role]) {
                        emailInput.value = credentials[role].email;
                        passwordInput.value = credentials[role].password;
                    }
                });

                loginForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const selectedRole = roleSelect.value;

                    // Simulate login delay
                    const btn = loginForm.querySelector('button');
                    const originalText = btn.innerHTML;
                    btn.disabled = true;
                    btn.innerHTML = `<svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white inline" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> Logging in...`;

                    setTimeout(() => {
                        state.currentUserRole = selectedRole;

                        // Fade out login
                        loginPage.style.opacity = '0';

                        setTimeout(() => {
                            loginPage.classList.add('hidden');
                            appContainer.classList.remove('hidden');

                            // Trigger reflow
                            void appContainer.offsetWidth;

                            appContainer.classList.add('flex');
                            appContainer.style.opacity = '1';

                            // Initialize app
                            updateUserUI();
                            initMobileMenu();

                            btn.disabled = false;
                            btn.innerHTML = originalText;
                        }, 500);
                    }, 800);
                });
            }

            function initMobileMenu() {
                const btn = document.getElementById('mobile-menu-btn');
                const sidebar = document.getElementById('sidebar');
                const backdrop = document.getElementById('mobile-menu-backdrop');
                const closeBtn = document.getElementById('close-sidebar-btn');

                function toggleMenu() {
                    const isClosed = sidebar.classList.contains('-translate-x-full');
                    if (isClosed) {
                        sidebar.classList.remove('-translate-x-full');
                        backdrop.classList.remove('hidden');
                    } else {
                        sidebar.classList.add('-translate-x-full');
                        backdrop.classList.add('hidden');
                    }
                }

                btn.onclick = toggleMenu;
                closeBtn.onclick = toggleMenu;
                backdrop.onclick = toggleMenu;

                // Close menu on link click
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.addEventListener('click', () => {
                        if (window.innerWidth < 768) {
                            sidebar.classList.add('-translate-x-full');
                            backdrop.classList.add('hidden');
                        }
                    });
                });
            }



            // Initialize Login
            initLogin();

            // -----------------------------------------------------------------------------
            // 4. PAGE RENDERING FUNCTIONS
            // -----------------------------------------------------------------------------

            function renderDashboard() {
                const page = document.getElementById('page-dashboard');
                const role = state.currentUserRole;
                if (role === 'CEO') renderCeoDashboard(page);
                else if (role === 'Agent') renderAgentDashboard(page);
                else if (role === 'Admin') renderAdminDashboard(page);
            }

            function renderAdminDashboard(page) {
                page.innerHTML = `
        <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-4">
            <div class="bg-white border rounded-xl p-6 shadow-sm hover:shadow-md transition-shadow">
                <h3 class="text-sm font-medium text-gray-500">System Status</h3>
                <div class="flex items-center gap-2 mt-4">
                    <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                    <p class="text-2xl font-bold text-gray-900">Operational</p>
                </div>
            </div>
            <div class="bg-white border rounded-xl p-6 shadow-sm hover:shadow-md transition-shadow">
                <h3 class="text-sm font-medium text-gray-500">Active Users</h3>
                <p class="text-2xl font-bold mt-4 text-gray-900">${Object.keys(users).length}</p>
            </div>
            <div class="bg-white border rounded-xl p-6 shadow-sm hover:shadow-md transition-shadow">
                <h3 class="text-sm font-medium text-gray-500">Inactive Users</h3>
                <p class="text-2xl font-bold mt-4 text-gray-900">${inactiveUsers.length}</p>
            </div>
            <div class="bg-white border rounded-xl p-6 shadow-sm hover:shadow-md transition-shadow">
                <h3 class="text-sm font-medium text-gray-500">System Errors (24h)</h3>
                <p class="text-2xl font-bold mt-4 ${systemErrors.length > 0 ? 'text-red-600' : 'text-green-600'}">${systemErrors.length}</p>
            </div>
        </div>
        <div class="mt-8 bg-white border rounded-xl shadow-sm overflow-hidden">
            <div class="p-6 border-b bg-gray-50"><h3 class="font-semibold text-gray-900">AI Assistant Overview</h3></div>
            <div class="overflow-x-auto">
                <table class="w-full text-sm">
                    <thead>
                        <tr class="text-left text-gray-500 bg-gray-50 border-b">
                            <th class="p-4 font-medium">Assistant</th>
                            <th class="p-4 font-medium">Owner</th>
                            <th class="p-4 font-medium">Dialogs Today</th>
                            <th class="p-4 font-medium">Conversion</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-100">
                        ${assistantStats.map(s => `
                            <tr class="hover:bg-gray-50 transition-colors">
                                <td class="p-4 font-medium text-gray-900 flex items-center gap-2">
                                    <div class="w-8 h-8 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center text-xs">${ICONS.bot}</div>
                                    ${s.assistant}
                                </td>
                                <td class="p-4 text-gray-600">${s.owner}</td>
                                <td class="p-4 text-gray-900 font-medium">${s.dialogs}</td>
                                <td class="p-4 text-green-600 font-medium">${s.conversion}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>
        </div>
        <div class="mt-8 bg-white border rounded-xl shadow-sm overflow-hidden">
            <div class="p-6 border-b bg-gray-50"><h3 class="font-semibold text-gray-900">Recent System Errors</h3></div>
            <div class="overflow-x-auto">
                <table class="w-full text-sm">
                    <thead>
                        <tr class="text-left text-gray-500 bg-gray-50 border-b">
                            <th class="p-4 font-medium">Time</th>
                            <th class="p-4 font-medium">Code</th>
                            <th class="p-4 font-medium">Message</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-100">
                        ${systemErrors.map(e => `
                            <tr class="hover:bg-gray-50 transition-colors">
                                <td class="p-4 text-gray-500">${e.time}</td>
                                <td class="p-4 font-mono text-xs bg-gray-100 rounded px-2 py-1 w-fit">${e.code}</td>
                                <td class="p-4 text-gray-700">${e.message}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>
        </div>`;
            }

            function renderCeoDashboard(page) {
                // Calculate dynamic stats
                const activeDealsCount = dealsData.filter(d => !['Closed Won', 'Closed Lost'].includes(d.status)).length;
                const newLeadsCount = dealsData.filter(d => d.status === 'New Lead').length;

                const kpiData = [
                    { title: 'Total Revenue', value: '$12,450,000', change: '+15.2%', trend: 'up' },
                    { title: 'Active Deals', value: activeDealsCount.toString(), change: '+5 this week', trend: 'up' },
                    { title: 'New Leads (Today)', value: newLeadsCount.toString(), change: '+2 today', trend: 'up' },
                    { title: 'Conversion Rate', value: '4.8%', change: '-0.2%', trend: 'down' }
                ];

                page.innerHTML = `
                    <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-4">
                        ${kpiData.map(kpi => `
                            <div class="bg-white border rounded-xl p-6 shadow-sm hover:shadow-md transition-all duration-200">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <h3 class="text-sm font-medium text-gray-500">${kpi.title}</h3>
                                        <p class="text-3xl font-bold mt-2 text-gray-900">${kpi.value}</p>
                                    </div>
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${kpi.trend === 'up' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                        ${kpi.trend === 'up' ? '‚Üë' : '‚Üì'} ${kpi.change}
                                    </span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="grid gap-6 mt-8 grid-cols-1 lg:grid-cols-3">
                        <div class="lg:col-span-2 bg-white border rounded-xl shadow-sm overflow-hidden">
                            <div class="p-6 border-b flex justify-between items-center">
                                <h3 class="font-semibold text-lg text-gray-900">Team Pulse</h3>
                                <button class="text-sm text-blue-600 hover:text-blue-700 font-medium">View All</button>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full text-sm">
                                    <thead>
                                        <tr class="text-left text-gray-500 bg-gray-50 border-b">
                                            <th class="py-3 px-6 font-medium">Agent</th>
                                            <th class="py-3 px-6 font-medium">Active Dialogs</th>
                                            <th class="py-3 px-6 font-medium">Avg. Response</th>
                                            <th class="py-3 px-6 font-medium">Conversion</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-100">
                                        ${teamPulseData.map(p => `
                                            <tr class="hover:bg-gray-50 transition-colors">
                                                <td class="py-4 px-6 font-medium text-gray-900 flex items-center gap-3">
                                                    <div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center text-xs font-bold text-gray-600">
                                                        ${p.agent.split(' ').map(n => n[0]).join('')}
                                                    </div>
                                                    ${p.agent}
                                                </td>
                                                <td class="py-4 px-6 text-gray-600">${p.dialogs}</td>
                                                <td class="py-4 px-6 text-gray-600">${p.responseTime}</td>
                                                <td class="py-4 px-6 text-gray-900 font-medium">${p.conversion}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-br from-gray-900 to-gray-800 border border-gray-700 rounded-xl p-6 text-white flex flex-col justify-center items-center text-center shadow-lg relative overflow-hidden">
                            <div class="absolute top-0 right-0 -mt-4 -mr-4 w-24 h-24 bg-white opacity-5 rounded-full blur-xl"></div>
                            <div class="bg-white/10 text-yellow-400 rounded-full p-4 mb-4 backdrop-blur-sm">
                                ${ICONS.anomaly}
                            </div>
                            <h3 class="font-semibold text-lg mt-2">AI Anomaly Detected</h3>
                            <p class="text-gray-300 mt-2 text-sm leading-relaxed">
                                <span class="font-medium text-white">${ceoAnomaly.agent}</span>'s ${ceoAnomaly.metric} is <span class="font-bold text-white">${ceoAnomaly.value}</span>. This is unusually high.
                            </p>
                            <button class="mt-6 bg-white text-gray-900 px-6 py-2 rounded-lg text-sm font-medium hover:bg-gray-100 transition-colors w-full">
                                Review Details
                            </button>
                        </div>
                    </div>
                    
                    <div class="mt-8 bg-white border rounded-xl shadow-sm p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="font-semibold text-lg text-gray-900">Leads Acquisition Trend</h3>
                            <select class="text-sm border-gray-300 rounded-md text-gray-600 focus:ring-blue-500 focus:border-blue-500">
                                <option>Last 8 Weeks</option>
                                <option>Last Quarter</option>
                                <option>Year to Date</option>
                            </select>
                        </div>
                        <div class="h-80">
                            <canvas id="ceoLeadsChart"></canvas>
                        </div>
                    </div>
                `;
                renderCeoCharts();
            }

            function renderAgentDashboard(page) {
                // Dynamic counts
                const hotLeadsCount = dealsData.slice(0, 3).length; // Mock logic for "hot"
                const approvalCount = assistantDialogs.filter(d => d.status === 'Approval Needed').length;
                const urgentTasksCount = tasksData.filter(t => t.status === 'Overdue').length;

                page.innerHTML = `
                    <div class="bg-white border rounded-xl shadow-sm p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="font-semibold text-xl text-gray-900">My Focus Today</h3>
                            <span class="text-sm text-gray-500">${new Date().toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' })}</span>
                        </div>
                        
                        <div class="border-b border-gray-100">
                            <nav class="-mb-px flex gap-8" id="focus-tabs">
                                <button class="focus-tab tab-active py-4 border-b-2 border-blue-600 text-blue-600 font-medium transition-colors flex items-center gap-2" data-tab="hot-leads">
                                    <span>üî•</span> Hot Leads <span class="bg-blue-100 text-blue-700 py-0.5 px-2 rounded-full text-xs">${hotLeadsCount}</span>
                                </button>
                                <button class="focus-tab py-4 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium transition-colors flex items-center gap-2" data-tab="approvals">
                                    <span>üëç</span> Awaiting Approval <span class="bg-gray-100 text-gray-700 py-0.5 px-2 rounded-full text-xs">${approvalCount}</span>
                                </button>
                                <button class="focus-tab py-4 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium transition-colors flex items-center gap-2" data-tab="tasks">
                                    <span>‚ùó</span> Urgent Tasks <span class="bg-red-100 text-red-700 py-0.5 px-2 rounded-full text-xs">${urgentTasksCount}</span>
                                </button>
                            </nav>
                        </div>
                        
                        <div class="pt-6 min-h-[200px]">
                            <div id="tab-hot-leads" class="focus-tab-content space-y-3">
                                ${dealsData.slice(0, 3).map(deal => `
                                    <a href="#deal-details/${deal.id}" class="group block p-4 border border-gray-200 rounded-xl hover:border-blue-300 hover:bg-blue-50/50 transition-all">
                                        <div class="flex justify-between items-start">
                                            <div>
                                                <h4 class="font-semibold text-gray-900 group-hover:text-blue-700">${deal.client}</h4>
                                                <p class="text-sm text-gray-600 mt-1">${deal.summary}</p>
                                            </div>
                                            <span class="text-xs font-medium bg-white border border-gray-200 px-2 py-1 rounded text-gray-500 group-hover:border-blue-200 group-hover:text-blue-600">View Deal</span>
                                        </div>
                                    </a>
                                `).join('')}
                            </div>
                            
                            <div id="tab-approvals" class="focus-tab-content page-hidden space-y-3">
                                ${assistantDialogs.filter(d => d.status === 'Approval Needed').length > 0 ? assistantDialogs.filter(d => d.status === 'Approval Needed').map(d => `
                                    <div data-offer-id="${d.id}" class="approval-item cursor-pointer p-4 border border-gray-200 rounded-xl hover:border-green-300 hover:bg-green-50/50 transition-all">
                                        <div class="flex items-start gap-3">
                                            <div class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center text-green-600 flex-shrink-0">
                                                ${ICONS.bot}
                                            </div>
                                            <div>
                                                <h4 class="font-semibold text-gray-900">Offer for ${d.client}</h4>
                                                <p class="text-sm text-gray-600 mt-1">Jessica has prepared a new offer page. Review content before sending.</p>
                                                <button class="mt-3 text-sm font-medium text-green-700 hover:text-green-800 hover:underline">Review & Send &rarr;</button>
                                            </div>
                                        </div>
                                    </div>
                                `).join('') : '<p class="text-gray-500 text-center py-8">No items awaiting approval.</p>'}
                            </div>
                            
                            <div id="tab-tasks" class="focus-tab-content page-hidden space-y-3">
                                ${tasksData.filter(t => t.status === 'Overdue').length > 0 ? tasksData.filter(t => t.status === 'Overdue').map(t => `
                                    <a href="#tasks" class="group block p-4 border border-red-200 bg-red-50/30 rounded-xl hover:bg-red-50 transition-all">
                                        <div class="flex items-center gap-3">
                                            <div class="w-2 h-2 rounded-full bg-red-500"></div>
                                            <div class="flex-1">
                                                <h4 class="font-medium text-gray-900 group-hover:text-red-700">${t.title}</h4>
                                                <p class="text-xs text-red-600 mt-1">Overdue by ${t.due}</p>
                                            </div>
                                            <span class="text-sm text-gray-400 group-hover:text-gray-600">&rarr;</span>
                                        </div>
                                    </a>
                                `).join('') : '<p class="text-gray-500 text-center py-8">No urgent tasks.</p>'}
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid gap-6 mt-8 grid-cols-1 lg:grid-cols-2">
                        <div class="bg-white border rounded-xl shadow-sm p-6">
                            <h3 class="font-semibold text-lg text-gray-900 mb-6">My Deal Pipeline</h3>
                            <div class="h-64">
                                <canvas id="agentPipelineChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="bg-white border rounded-xl shadow-sm p-6">
                            <h3 class="font-semibold text-lg text-gray-900 mb-6">My Recent Activity</h3>
                            <div class="space-y-6 relative">
                                <div class="absolute left-2.5 top-2 bottom-2 w-0.5 bg-gray-100"></div>
                                
                                <div class="relative pl-8">
                                    <div class="absolute left-0 top-1.5 w-5 h-5 rounded-full border-2 border-white bg-blue-500 shadow-sm z-10"></div>
                                    <p class="text-sm text-gray-900"><span class="font-semibold text-blue-600">Jessica</span> sent an offer to <span class="font-medium">Elon Musk</span>.</p>
                                    <p class="text-xs text-gray-500 mt-1">10 minutes ago</p>
                                </div>
                                
                                <div class="relative pl-8">
                                    <div class="absolute left-0 top-1.5 w-5 h-5 rounded-full border-2 border-white bg-green-500 shadow-sm z-10"></div>
                                    <p class="text-sm text-gray-900">You closed the deal for <span class="font-medium">Villa in Palm Jumeirah</span>.</p>
                                    <p class="text-xs text-gray-500 mt-1">2 hours ago</p>
                                </div>
                                
                                <div class="relative pl-8">
                                    <div class="absolute left-0 top-1.5 w-5 h-5 rounded-full border-2 border-white bg-purple-500 shadow-sm z-10"></div>
                                    <p class="text-sm text-gray-900">New task assigned: <span class="font-medium">Follow up with Jeff Bezos</span>.</p>
                                    <p class="text-xs text-gray-500 mt-1">Yesterday</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                renderAgentCharts();
            }

            function renderMyAssistantPage() {
                const page = document.getElementById('page-my-assistant');

                // Preset questions - shortened for minimalism
                const presetQuestions = [
                    "üî• Hot leads today",
                    "üíº Active deals",
                    "üìä Conversion report",
                    "üè† New properties",
                    "üìû Calls for today",
                    "üìà Market analysis"
                ];

                page.innerHTML = `
        <div class="max-w-5xl mx-auto px-4 py-6">

            
            <!-- Quick commands - horizontal scroll -->
            <div class="mb-8">
                <div class="flex gap-3 overflow-x-auto pb-2 scrollbar-hide">
                    ${presetQuestions.map(question => `
                        <button class="preset-question quick-command-btn flex-shrink-0 border border-gray-300 rounded-md px-3 py-2 text-sm hover:bg-gray-50">${question}</button>
                    `).join('')}
                </div>
            </div>
            
            <!-- Main chat area - centered -->
            <div class="max-w-4xl mx-auto">
                
                <!-- Main chat area -->
                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 flex flex-col h-[70vh] min-h-[500px]">
                    <!-- Chat status bar -->
                    <div class="px-6 py-4 border-b border-gray-100">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <div class="w-3 h-3 bg-green-500 rounded-full status-indicator"></div>
                                <span class="text-sm font-medium text-gray-900">Assistant Active</span>
                            </div>
                            <div class="text-xs text-gray-500">Avg. response time: 1.2s</div>
                        </div>
                    </div>
                    
                    <!-- Messages area -->
                    <div id="chat-messages" class="flex-1 overflow-y-auto px-6 py-6 space-y-6">
                        <!-- Welcome message -->
                        <div class="flex items-start gap-4">
                            <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center flex-shrink-0">
                                <svg class="h-5 w-5 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                                    <path d="M2 17l10 5 10-5"/>
                                    <path d="M2 12l10 5 10-5"/>
                                </svg>
                            </div>
                            <div class="bg-gray-50 rounded-2xl rounded-tl-md p-4 max-w-[85%]">
                                <p class="text-gray-800 leading-relaxed">Hello! I am your personal AI real estate assistant. I am ready to help with lead analysis, report generation, and client information search.</p>
                                <div class="flex items-center gap-3 mt-3 pt-2 border-t border-gray-200">
                                    <span class="text-xs text-gray-500">Just now</span>
                                    <button class="copy-message text-xs font-medium text-gray-600 hover:text-gray-800">Copy</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Input form -->
                    <div class="px-6 py-4 border-t border-gray-100">
                        <form id="chat-form" class="flex gap-3">
                            <div class="flex-1 relative">
                                <input 
                                    type="text" 
                                    id="chat-input" 
                                    placeholder="Ask the assistant..." 
                                    class="w-full px-4 py-3 pr-12 bg-gray-50 border-0 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:bg-white transition-all duration-200 text-gray-900 placeholder-gray-500"
                                    autocomplete="off"
                                >
                                <button class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600" id="search-btn" title="Search history">
                                    <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="11" cy="11" r="8"/>
                                        <path d="m21 21-4.35-4.35"/>
                                    </svg>
                                </button>
                            </div>
                            <button type="submit" class="btn-primary bg-blue-600 text-white px-6 py-3 rounded-xl hover:bg-blue-700 flex items-center gap-2 font-medium shadow-sm">
                                <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="22" y1="2" x2="11" y2="13"/>
                                    <polygon points="22,2 15,22 11,13 2,9"/>
                                </svg>
                                <span class="hidden sm:inline">Send</span>
                            </button>
                        </form>
                    </div>
                    </div>
                </div>
            </div>
            
            <!-- Statistics and settings - compact block -->
            <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Statistics -->
                <div class="stat-card bg-white rounded-xl border border-gray-100 p-6">
                    <h3 class="font-medium text-gray-900 mb-4">Statistics Today</h3>
                    <div class="grid grid-cols-3 gap-4">
                        <div class="text-center">
                            <div class="text-2xl font-bold text-blue-600">12</div>
                            <div class="text-xs text-gray-500">Requests</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-green-600">1.2s</div>
                            <div class="text-xs text-gray-500">Response</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-purple-600">8</div>
                            <div class="text-xs text-gray-500">Resolved</div>
                        </div>
                    </div>
                </div>
                
                <!-- Settings -->
                <div class="stat-card bg-white rounded-xl border border-gray-100 p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-medium text-gray-900">Settings</h3>
                            <p class="text-sm text-gray-500 mt-1">Assistant Personalization</p>
                        </div>
                        <a href="#my-assistant-settings" class="bg-gray-900 text-white px-4 py-2 rounded-lg font-medium hover:bg-gray-800 transition-colors inline-block">Configure</a>
                    </div>
                </div>
            </div>
        </div>
    `;

                // Initialize event handlers
                initializeChatHandlers();

                // Load chat history when opening the page
                updateChatHistoryDisplay();
            }

            // Function to initialize chat handlers
            function initializeChatHandlers() {
                const chatForm = document.getElementById('chat-form');
                const chatInput = document.getElementById('chat-input');
                const chatMessages = document.getElementById('chat-messages');
                const presetButtons = document.querySelectorAll('.preset-question');

                // Form submission handler
                if (chatForm) {
                    chatForm.addEventListener('submit', function (e) {
                        e.preventDefault();
                        const message = chatInput.value.trim();
                        if (message) {
                            addUserMessage(message);
                            chatInput.value = '';
                            // Simulate assistant response
                            setTimeout(() => {
                                addAssistantMessage(generateAssistantResponse(message));
                            }, 1000);
                        }
                    });
                }

                // Preset questions handlers
                presetButtons.forEach(button => {
                    button.addEventListener('click', function () {
                        const question = this.textContent.trim();
                        chatInput.value = question;
                        chatInput.focus();
                    });
                });

                // Message copy handlers
                document.addEventListener('click', function (e) {
                    if (e.target.classList.contains('copy-message')) {
                        const messageText = e.target.closest('.bg-muted').querySelector('p').textContent;
                        navigator.clipboard.writeText(messageText).then(() => {
                            e.target.textContent = 'Copied!';
                            setTimeout(() => {
                                e.target.textContent = 'Copy';
                            }, 2000);
                        });
                    }
                });
            }

            // Function to add user message
            function addUserMessage(message) {
                const chatMessages = document.getElementById('chat-messages');

                // Add separator if there are previous messages
                if (chatMessages.children.length > 0) {
                    const separator = document.createElement('div');
                    separator.className = 'message-separator';
                    chatMessages.appendChild(separator);
                }

                const messageDiv = document.createElement('div');
                messageDiv.className = 'message flex items-start gap-3 justify-end';
                messageDiv.innerHTML = `
        <div class="user-message text-white rounded-lg p-3 max-w-[80%]">
            <p class="text-sm">${message}</p>
            <div class="flex items-center gap-2 mt-2 justify-end">
                <span class="chat-timestamp">Just now</span>
            </div>
        </div>
        <div class="user-avatar w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0">
            <span class="text-xs font-bold">${state.currentUserRole.substring(0, 2)}</span>
        </div>
    `;
                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;

                // Save message to history
                saveChatMessage(message, 'user');
            }

            // Function to add assistant response
            function addAssistantMessage(message) {
                const chatMessages = document.getElementById('chat-messages');

                // Add separator if there are previous messages
                if (chatMessages.children.length > 0) {
                    const separator = document.createElement('div');
                    separator.className = 'message-separator';
                    chatMessages.appendChild(separator);
                }

                const messageDiv = document.createElement('div');
                messageDiv.className = 'message flex items-start gap-3';
                messageDiv.innerHTML = `
        <div class="assistant-avatar w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0">
            <svg class="h-4 w-4 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 8V4H8"/>
                <rect x="4" y="4" width="16" height="16" rx="2"/>
            </svg>
        </div>
        <div class="assistant-message rounded-lg p-3 max-w-[80%]">
            <p class="text-sm">${message}</p>
            <div class="flex items-center gap-2 mt-2">
                <span class="chat-timestamp">Just now</span>
                <button class="copy-message text-xs text-accent hover:underline">Copy</button>
            </div>
        </div>
    `;
                chatMessages.appendChild(messageDiv);

                // Save message to history
                saveChatMessage(message, 'assistant');

                // Save dialog to history after receiving assistant response
                saveDialogToHistory();
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }

            // Function to generate assistant response (simulation)
            function generateAssistantResponse(userMessage) {
                const responses = {
                    'hot leads': 'üî• **Found 3 hot leads for today:**\n\n1. **Elon Musk** - Interest in downtown penthouse, budget $2M\n2. **Jeff Bezos** - Looking for a seaside villa, budget $5M\n3. **Bill Gates** - Commercial property, budget $10M\n\n‚úÖ All leads are active and awaiting contact today.',
                    'deals': 'üíº **You have 5 active deals requiring attention:**\n\n‚Ä¢ **Villa Paradise** - awaiting signing (Elon Musk)\n‚Ä¢ **Downtown Penthouse** - in negotiation stage\n‚Ä¢ **Seaside Resort** - requires detail clarification\n\nüí∞ Total deal value: $12.5M',
                    'conversion': 'üìä **Conversion Report for the week:**\n\nüìà **Total Conversion**: 4.8%\nüöÄ **Growth**: +0.3% vs last week\nüéØ **Best Day**: Tuesday (6.2%)\nüìû **Source**: Cold calls showed best results',
                    'budget': 'üí∞ **Clients with budget over $500K:**\n\nüíé **Elon Musk** - $2M (active)\nüíé **Jeff Bezos** - $5M (hot lead)\nüíé **Bill Gates** - $10M (negotiation)\nüíé **Warren Buffett** - $1.5M (considering)\n\nüìä Total: 4 clients, total potential $18.5M',
                    'agents': 'üë• **Agent Statistics:**\n\nü•á **Jessica Smith**: 8 active dialogs, conversion 6.2%\nü•à **Michael Johnson**: 12 leads, conversion 4.1%\nü•â **Sarah Davis**: 6 deals in progress, conversion 5.8%\n\nüèÜ Agent of the week: Jessica Smith',
                    'tasks': '‚è∞ **Overdue Tasks:**\n\nüî¥ **Call Jeff Bezos** - overdue by 2 days\nüî¥ **Prepare Villa Paradise contract** - overdue by 1 day\nüü° **Meeting with Bill Gates** - today at 15:00\n\n‚ö° Recommend processing these tasks urgently.',
                    'properties': 'üè† **New Properties:**\n\nüÜï **Luxury Villa**, Palm Jumeirah - $3.2M\nüÜï **Penthouse**, Downtown Dubai - $2.8M\nüÜï **Townhouse**, Arabian Ranches - $1.5M\nüÜï **Office Space**, DIFC - $4.1M\n\nüìÖ All properties added in the last 24 hours',
                    'calls': 'üìû **Call List for Today:**\n\nüî• **14:00** - Elon Musk (hot lead)\nüìã **15:30** - Sarah Connor (clarify details)\nüíº **16:00** - Warren Buffett (new offer)\nüìä **17:00** - Bill Gates (final negotiations)\n\n‚è∞ Next call in 2 hours',
                    'analysis': 'üìà **Real Estate Market Analysis:**\n\nüìä Average Price: $1.8M (+5% this month)\nüè† Most Popular Type: Villas (40%)\nüìç Top Area: Palm Jumeirah\n‚è±Ô∏è Avg. Sale Time: 45 days\n\nüéØ **Recommendation**: focus on premium segment',
                    'promising': 'üéØ **Top 5 Promising Clients:**\n\n1. üíé **Elon Musk** - $2.5M (probability 85%)\n2. üíé **Jeff Bezos** - $1.8M (probability 70%)\n3. üíé **Bill Gates** - $3.2M (probability 60%)\n4. üí∞ **Warren Buffett** - $900K (probability 55%)\n5. üí∞ **Tim Cook** - $1.2M (probability 45%)\n\nüöÄ **Total Potential**: $9.6M',
                    'plan': 'üìã **Work Plan for Tomorrow:**\n\nüåÖ **09:00** - Call Elon Musk\nüìä **10:30** - Prepare sales report\nüè† **12:00** - Property viewing with Jeff Bezos\nüìû **14:00** - Call new leads\nüìù **16:00** - Update CRM\n\n‚úÖ 5 tasks scheduled',
                    'presentation': 'üí¨ **Preparing Client Presentation:**\n\nüìã Choose presentation type:\n‚Ä¢ üè† Property Object\n‚Ä¢ üí∞ Investment Proposal\n‚Ä¢ üìä Analytical Report\n‚Ä¢ üéØ Personal Offer\n\n‚ö° Presentation will be ready in 15 minutes'
                };

                const lowerMessage = userMessage.toLowerCase();

                for (const [key, response] of Object.entries(responses)) {
                    if (lowerMessage.includes(key)) {
                        return response;
                    }
                }

                return 'Understood your request. Analyzing data... ü§î\n\nUnfortunately, I did not find an exact match in the database. Try rephrasing the question or use the quick commands on the left.';
            }

            // Initialize chat event handlers
            function initChatHandlers() {
                const chatForm = document.getElementById('chatForm');
                const chatInput = document.getElementById('chatInput');
                const sendButton = document.getElementById('sendButton');
                const presetQuestions = document.querySelectorAll('.preset-question');

                if (chatForm) {
                    chatForm.addEventListener('submit', function (e) {
                        e.preventDefault();
                        const message = chatInput.value.trim();
                        if (message) {
                            addMessage(message, 'user');
                            chatInput.value = '';

                            // Simulate assistant response
                            setTimeout(() => {
                                const response = generateAssistantResponse(message);
                                addMessage(response, 'assistant');
                            }, 1000);
                        }
                    });
                }

                // Handlers for preset questions
                presetQuestions.forEach(button => {
                    button.addEventListener('click', function () {
                        const command = this.textContent.trim();
                        addMessage(command, 'user');

                        // Visual feedback
                        this.style.backgroundColor = '#e5e7eb';
                        setTimeout(() => {
                            this.style.backgroundColor = '';
                        }, 200);

                        setTimeout(() => {
                            const response = generateAssistantResponse(command);
                            addMessage(response, 'assistant');
                        }, 1000);
                    });
                });

                // Autofocus on input field
                if (chatInput) {
                    chatInput.focus();
                }
            }

            // Add message to chat
            function addMessage(message, sender) {
                const messagesContainer = document.getElementById('chatMessages');
                if (!messagesContainer) return;

                const messageDiv = document.createElement('div');
                messageDiv.className = `flex gap-3 ${sender === 'user' ? 'justify-end' : 'justify-start'}`;

                const isUser = sender === 'user';
                const messageId = 'msg_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);

                messageDiv.innerHTML = `
        <div class="max-w-xs lg:max-w-md px-4 py-2 rounded-lg relative group ${isUser
                        ? 'bg-blue-500 text-white'
                        : 'bg-gray-100 text-gray-800'
                    }">
            <div class="flex items-start justify-between">
                <div class="flex-1">
                    <p class="text-sm whitespace-pre-wrap" id="${messageId}">${message}</p>
                    <p class="text-xs mt-1 opacity-70">${new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}</p>
                </div>
                ${!isUser ? `
                    <button onclick="copyMessage('${messageId}')" 
                            class="ml-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200 p-1 rounded hover:bg-gray-200 flex-shrink-0"
                            title="Copy message">
                        <svg class="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                        </svg>
                    </button>
                ` : ''}
            </div>
        </div>
    `;

                messagesContainer.appendChild(messageDiv);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }

            // Function to copy message
            function copyMessage(messageId) {
                const messageElement = document.getElementById(messageId);
                if (!messageElement) return;

                const text = messageElement.textContent;

                // Use modern Clipboard API
                if (navigator.clipboard && window.isSecureContext) {
                    navigator.clipboard.writeText(text).then(() => {
                        showCopyNotification();
                    }).catch(err => {
                        console.error('Copy error:', err);
                        fallbackCopyTextToClipboard(text);
                    });
                } else {
                    fallbackCopyTextToClipboard(text);
                }
            }

            // Fallback copy method for older browsers
            function fallbackCopyTextToClipboard(text) {
                const textArea = document.createElement('textarea');
                textArea.value = text;
                textArea.style.position = 'fixed';
                textArea.style.left = '-999999px';
                textArea.style.top = '-999999px';
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();

                try {
                    document.execCommand('copy');
                    showCopyNotification();
                } catch (err) {
                    console.error('Copy error:', err);
                }

                document.body.removeChild(textArea);
            }

            // Show copy notification
            function showCopyNotification() {
                // Create temporary notification
                const notification = document.createElement('div');
                notification.className = 'fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 transition-all duration-300';
                notification.textContent = '‚úÖ Message copied!';

                document.body.appendChild(notification);

                // Remove notification after 2 seconds
                setTimeout(() => {
                    notification.style.opacity = '0';
                    notification.style.transform = 'translateY(-20px)';
                    setTimeout(() => {
                        document.body.removeChild(notification);
                    }, 300);
                }, 2000);
            }

            // Variable to store current dialog
            let currentDialog = {
                messages: [],
                startTime: null,
                userQuestion: '',
                assistantResponse: ''
            };

            // Function to save message to current dialog
            function saveChatMessage(message, sender) {
                if (!currentDialog.startTime) {
                    currentDialog.startTime = new Date();
                }

                currentDialog.messages.push({
                    text: message,
                    sender: sender,
                    timestamp: new Date()
                });

                if (sender === 'user') {
                    currentDialog.userQuestion = message;
                } else if (sender === 'assistant') {
                    currentDialog.assistantResponse = message;
                }
            }

            // Function to save dialog to history
            function saveDialogToHistory() {
                if (currentDialog.messages.length >= 2) {
                    const dialogHistory = getChatHistory();

                    const dialogSummary = {
                        id: Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                        title: generateDialogTitle(currentDialog.userQuestion),
                        userQuestion: currentDialog.userQuestion,
                        assistantResponse: currentDialog.assistantResponse,
                        timestamp: currentDialog.startTime,
                        messages: [...currentDialog.messages]
                    };

                    dialogHistory.unshift(dialogSummary);

                    // Limit history to 50 dialogs
                    if (dialogHistory.length > 50) {
                        dialogHistory.splice(50);
                    }

                    localStorage.setItem('chatHistory', JSON.stringify(dialogHistory));

                    // Update history display
                    updateChatHistoryDisplay();

                    // Reset current dialog
                    currentDialog = {
                        messages: [],
                        startTime: null,
                        userQuestion: '',
                        assistantResponse: ''
                    };
                }
            }

            // Function to get chat history
            function getChatHistory() {
                try {
                    const history = localStorage.getItem('chatHistory');
                    return history ? JSON.parse(history) : [];
                } catch (error) {
                    console.error('Error loading history:', error);
                    return [];
                }
            }

            // Function to generate dialog title
            function generateDialogTitle(userQuestion) {
                const question = userQuestion.toLowerCase();

                if (question.includes('lead') || question.includes('hot')) {
                    return 'Hot Leads Analysis';
                } else if (question.includes('deal') || question.includes('transaction')) {
                    return 'Deals Information';
                } else if (question.includes('conversion') || question.includes('report')) {
                    return 'Conversion Report';
                } else if (question.includes('budget') || question.includes('price')) {
                    return 'Budget Analysis';
                } else if (question.includes('agent') || question.includes('team')) {
                    return 'Team Information';
                } else if (question.includes('task') || question.includes('todo')) {
                    return 'Task Management';
                } else if (question.includes('property') || question.includes('object')) {
                    return 'Property Catalog';
                } else if (question.includes('call') || question.includes('phone')) {
                    return 'Call Analysis';
                } else if (question.includes('analysis')) {
                    return 'Analytical Report';
                } else {
                    return userQuestion.length > 30 ? userQuestion.substring(0, 30) + '...' : userQuestion;
                }
            }

            // Function to update history display
            function updateChatHistoryDisplay() {
                const historyContainer = document.getElementById('chat-history');
                if (!historyContainer) return;

                const history = getChatHistory();

                if (history.length === 0) {
                    historyContainer.innerHTML = '<p class="text-sm text-muted-foreground text-center py-4">Dialog history is empty</p>';
                    return;
                }

                historyContainer.innerHTML = history.map(dialog => {
                    const timeAgo = getTimeAgo(dialog.timestamp);
                    return `
            <div class="p-3 border rounded-md hover:bg-muted cursor-pointer" onclick="loadDialog('${dialog.id}')">
                <div class="flex justify-between items-start mb-1">
                    <span class="font-medium text-sm">${dialog.title}</span>
                    <span class="text-xs text-muted-foreground">${timeAgo}</span>
                </div>
                <p class="text-sm text-muted-foreground mb-1">You: "${dialog.userQuestion.length > 50 ? dialog.userQuestion.substring(0, 50) + '...' : dialog.userQuestion}"</p>
                <p class="text-sm text-muted-foreground">Assistant: "${dialog.assistantResponse.length > 50 ? dialog.assistantResponse.substring(0, 50) + '...' : dialog.assistantResponse}"</p>
            </div>
        `;
                }).join('');
            }

            // Function to get "ago" time
            function getTimeAgo(timestamp) {
                const now = new Date();
                const dialogTime = new Date(timestamp);
                const diffMs = now - dialogTime;
                const diffMins = Math.floor(diffMs / 60000);
                const diffHours = Math.floor(diffMs / 3600000);
                const diffDays = Math.floor(diffMs / 86400000);

                if (diffMins < 1) {
                    return 'Just now';
                } else if (diffMins < 60) {
                    return `${diffMins} min ago`;
                } else if (diffHours < 24) {
                    return `${diffHours} h ago`;
                } else if (diffDays === 1) {
                    return 'Yesterday';
                } else if (diffDays < 7) {
                    return `${diffDays} days ago`;
                } else {
                    return dialogTime.toLocaleDateString('ru-RU');
                }
            }

            // Function to load dialog into chat
            function loadDialog(dialogId) {
                const history = getChatHistory();
                const dialog = history.find(d => d.id === dialogId);

                if (!dialog) return;

                // Clear current chat
                const chatMessages = document.getElementById('chat-messages');
                if (chatMessages) {
                    chatMessages.innerHTML = '';
                }

                // Load messages from dialog
                dialog.messages.forEach(msg => {
                    if (msg.sender === 'user') {
                        addMessage(msg.text, 'user');
                    } else {
                        addMessage(msg.text, 'assistant');
                    }
                });
            }

            // Function to clear history
            function clearChatHistory() {
                if (confirm('Are you sure you want to clear the entire dialog history?')) {
                    localStorage.removeItem('chatHistory');
                    updateChatHistoryDisplay();

                    // Show notification
                    const notification = document.createElement('div');
                    notification.className = 'fixed top-4 right-4 bg-red-500 text-white px-4 py-2 rounded-lg shadow-lg z-50';
                    notification.textContent = 'üóëÔ∏è History cleared';
                    document.body.appendChild(notification);

                    setTimeout(() => {
                        document.body.removeChild(notification);
                    }, 2000);
                }
            }
            function renderMyAssistantSettingsPage() {
                const page = document.getElementById('page-my-assistant-settings');
                page.innerHTML = `
        <div class="space-y-6">
            <!-- Main assistant settings -->
            <div class="bg-white border rounded-lg">
                <div class="p-4 border-b">
                    <h3 class="font-semibold">Assistant Settings</h3>
                </div>
                <div class="p-6 space-y-6">
                    <div>
                        <label class="block text-sm font-medium mb-1">Assistant Name</label>
                        <input type="text" value="AI Assistant" class="w-full p-2 border rounded-md max-w-md">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Personal Prompt</label>
                        <textarea class="w-full p-2 border rounded-md h-32" placeholder="Describe how your assistant should behave...">You are a professional AI real estate assistant. Be friendly, efficient, and always ready to help with client tasks.</textarea>
                    </div>
                    <div class="flex items-center justify-between">
                        <label class="block text-sm font-medium">Use data from all agents</label>
                        <div class="relative inline-block w-10 align-middle select-none">
                            <input type="checkbox" name="toggle" id="toggle" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"/>
                            <label for="toggle" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"></label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Preset communication styles -->
            <div class="bg-white border rounded-lg">
                <div class="p-4 border-b">
                    <h3 class="font-semibold">Communication Styles</h3>
                </div>
                <div class="p-6">
                    <div class="grid gap-4 md:grid-cols-3">
                        <div class="border rounded-lg p-4 cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition-colors" onclick="selectCommunicationStyle('formal')">
                            <div class="flex items-center gap-2 mb-2">
                                <input type="radio" name="communication-style" value="formal" class="text-blue-600">
                                <h4 class="font-medium">Formal</h4>
                            </div>
                            <p class="text-sm text-gray-600">Professional and business communication style for corporate environment</p>
                        </div>
                        <div class="border rounded-lg p-4 cursor-pointer hover:bg-green-50 hover:border-green-300 transition-colors" onclick="selectCommunicationStyle('friendly')">
                            <div class="flex items-center gap-2 mb-2">
                                <input type="radio" name="communication-style" value="friendly" class="text-green-600" checked>
                                <h4 class="font-medium">Friendly</h4>
                            </div>
                            <p class="text-sm text-gray-600">Warm and welcoming style to create a comfortable atmosphere</p>
                        </div>
                        <div class="border rounded-lg p-4 cursor-pointer hover:bg-purple-50 hover:border-purple-300 transition-colors" onclick="selectCommunicationStyle('brief')">
                            <div class="flex items-center gap-2 mb-2">
                                <input type="radio" name="communication-style" value="brief" class="text-purple-600">
                                <h4 class="font-medium">Concise</h4>
                            </div>
                            <p class="text-sm text-gray-600">Concise and clear answers for quick task resolution</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Notification settings -->
            <div class="bg-white border rounded-lg">
                <div class="p-4 border-b">
                    <h3 class="font-semibold">Notifications</h3>
                </div>
                <div class="p-6 space-y-6">
                    <div>
                        <h4 class="font-medium mb-3">Trigger Conditions</h4>
                        <div class="space-y-3">
                            <label class="flex items-center gap-3">
                                <input type="checkbox" class="rounded" checked>
                                <span class="text-sm">New hot leads</span>
                            </label>
                            <label class="flex items-center gap-3">
                                <input type="checkbox" class="rounded" checked>
                                <span class="text-sm">Offer approval required</span>
                            </label>
                            <label class="flex items-center gap-3">
                                <input type="checkbox" class="rounded">
                                <span class="text-sm">Overdue tasks</span>
                            </label>
                            <label class="flex items-center gap-3">
                                <input type="checkbox" class="rounded">
                                <span class="text-sm">Important deal updates</span>
                            </label>
                        </div>
                    </div>
                    <div>
                        <h4 class="font-medium mb-3">Notification Methods</h4>
                        <div class="grid gap-3 md:grid-cols-2">
                            <label class="flex items-center gap-3">
                                <input type="checkbox" class="rounded" checked>
                                <span class="text-sm">In-app</span>
                            </label>
                            <label class="flex items-center gap-3">
                                <input type="checkbox" class="rounded">
                                <span class="text-sm">Email</span>
                            </label>
                            <label class="flex items-center gap-3">
                                <input type="checkbox" class="rounded">
                                <span class="text-sm">SMS</span>
                            </label>
                            <label class="flex items-center gap-3">
                                <input type="checkbox" class="rounded">
                                <span class="text-sm">Push notifications</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Integrations -->
            <div class="bg-white border rounded-lg">
                <div class="p-4 border-b">
                    <h3 class="font-semibold">Integrations</h3>
                </div>
                <div class="p-6">
                    <div class="grid gap-4 md:grid-cols-2">
                        <div class="border rounded-lg p-4">
                            <div class="flex items-center justify-between mb-3">
                                <div class="flex items-center gap-3">
                                    <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center">
                                        <svg class="w-4 h-4 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zM4 7h12v9H4V7z"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <h4 class="font-medium">Calendar</h4>
                                        <p class="text-sm text-gray-600">Google Calendar</p>
                                    </div>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="w-2 h-2 rounded-full bg-green-500"></span>
                                    <button class="text-sm bg-green-100 text-green-800 px-3 py-1 rounded-full">Connected</button>
                                </div>
                            </div>
                            <p class="text-xs text-gray-500">Sync meetings and reminders</p>
                        </div>

                        <div class="border rounded-lg p-4">
                            <div class="flex items-center justify-between mb-3">
                                <div class="flex items-center gap-3">
                                    <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center">
                                        <svg class="w-4 h-4 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <h4 class="font-medium">WhatsApp</h4>
                                        <p class="text-sm text-gray-600">Business API</p>
                                    </div>
                                </div>
                                <button class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2">
                                    <span>Save Changes</span>
                                </button>
                            </div>
                            <p class="text-xs text-gray-500">Send messages to clients</p>
                        </div>

                        <div class="border rounded-lg p-4">
                            <div class="flex items-center justify-between mb-3">
                                <div class="flex items-center gap-3">
                                    <div class="w-8 h-8 bg-red-100 rounded-lg flex items-center justify-center">
                                        <svg class="w-4 h-4 text-red-600" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/>
                                            <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <h4 class="font-medium">Email</h4>
                                        <p class="text-sm text-gray-600">SMTP/Gmail</p>
                                    </div>
                                </div>
                                <button class="text-sm bg-green-100 text-green-800 px-3 py-1 rounded-full">Connected</button>
                            </div>
                            <p class="text-xs text-gray-500">Automated email campaigns</p>
                        </div>

                        <div class="border rounded-lg p-4">
                            <div class="flex items-center justify-between mb-3">
                                <div class="flex items-center gap-3">
                                    <div class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center">
                                        <svg class="w-4 h-4 text-purple-600" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <h4 class="font-medium">CRM</h4>
                                        <p class="text-sm text-gray-600">Salesforce/HubSpot</p>
                                    </div>
                                </div>
                                <button class="text-sm bg-gray-100 text-gray-600 px-3 py-1 rounded-full hover:bg-gray-200 transition-colors">Connect</button>
                            </div>
                            <p class="text-xs text-gray-500">Sync contacts and deals</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Save settings button -->
            <div class="flex justify-end">
                <button onclick="saveAssistantSettings()" class="bg-black text-white py-2 px-6 rounded-md font-medium hover:bg-gray-800 transition-colors">Save Changes</button>
            </div>
        </div>
    `;
            }

            function saveAssistantSettings() {
                // Get form values
                const assistantName = document.getElementById('assistant-name')?.value || 'My Assistant';
                const language = document.getElementById('language')?.value || 'ru';
                const tone = document.getElementById('tone')?.value || 'professional';
                const responseSpeed = document.getElementById('response-speed')?.value || 'normal';
                const emailNotifications = document.getElementById('email-notifications')?.checked || false;
                const smsNotifications = document.getElementById('sms-notifications')?.checked || false;
                const whatsappIntegration = document.getElementById('whatsapp-integration')?.checked || false;
                const telegramIntegration = document.getElementById('telegram-integration')?.checked || false;

                // Save settings (in a real app this would be an API call)
                const settings = {
                    assistantName,
                    language,
                    tone,
                    responseSpeed,
                    notifications: {
                        email: emailNotifications,
                        sms: smsNotifications
                    },
                    integrations: {
                        whatsapp: whatsappIntegration,
                        telegram: telegramIntegration
                    },
                    savedAt: new Date().toISOString()
                };

                // Save to localStorage for demonstration
                localStorage.setItem('assistantSettings', JSON.stringify(settings));

                // Show success notification
                const notification = document.createElement('div');
                notification.className = 'fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-md shadow-lg z-50';
                notification.textContent = 'Settings saved successfully!';
                document.body.appendChild(notification);

                // Remove notification after 3 seconds
                setTimeout(() => {
                    notification.remove();
                }, 3000);

                console.log('Assistant settings saved:', settings);
            }

            // Simulation function for AI SDR
            window.simulateAiQualification = function () {
                const aiDeals = dealsData.filter(d => d.status === 'AI Qualification');
                if (aiDeals.length === 0) {
                    // If no deals in qualification, reset one for demo purposes
                    const demoDeal = dealsData.find(d => d.client === 'Sarah Connor');
                    if (demoDeal) {
                        demoDeal.status = 'AI Qualification';
                        window.simulateAiQualification(); // Retry
                        return;
                    }
                    alert('No deals available for simulation.');
                    return;
                }

                const deal = aiDeals[0];
                deal.status = 'Ready for Agent';
                deal.summary = '‚úÖ AI Qualified: Client confirmed budget of $5.5M and interest in Palm Jumeirah. Ready for viewing options.';

                // Show notification
                const notification = document.createElement('div');
                notification.className = 'fixed top-4 right-4 bg-green-600 text-white px-6 py-4 rounded-lg shadow-xl z-50 animate-in slide-in-from-right duration-300 flex items-center gap-3';
                notification.innerHTML = `
                    <div class="bg-white/20 p-2 rounded-full">
                        ${ICONS.bot}
                    </div>
                    <div>
                        <h4 class="font-bold">New Qualified Lead!</h4>
                        <p class="text-sm opacity-90">${deal.client} is ready for handoff.</p>
                    </div>
                `;
                document.body.appendChild(notification);

                setTimeout(() => {
                    notification.classList.add('opacity-0', 'translate-x-full');
                    setTimeout(() => notification.remove(), 300);
                }, 4000);

                // Refresh views
                renderDealsPage();
            }

            function renderDealsPage() {
                const page = document.getElementById('page-deals');
                const assistantName = state.currentUserRole === 'CEO' ? 'Leonardo' : 'Jessica';

                // Define statuses
                // Define statuses
                const aiStatuses = ['AI Outreach', 'AI Engaging', 'AI Qualification'];
                const agentStatuses = ['Ready for Agent', 'Offer Sent', 'Negotiation', 'Closed Won', 'Closed Lost'];

                let visibleStatuses = [];

                if (state.currentUserRole === 'Agent') {
                    // Agents only see their pipeline
                    visibleStatuses = agentStatuses;
                } else {
                    // Admins/CEO see everything
                    // Unsorted is always visible at the start
                    visibleStatuses = ['Unsorted'];

                    if (state.dealsFilter.showAiStages) {
                        visibleStatuses = [...visibleStatuses, ...aiStatuses, ...agentStatuses];
                    } else {
                        visibleStatuses = [...visibleStatuses, ...agentStatuses];
                    }
                }

                // Filter deals
                let filteredDeals = dealsData;
                if (state.dealsFilter.search) {
                    const term = state.dealsFilter.search.toLowerCase();
                    filteredDeals = filteredDeals.filter(d =>
                        d.title.toLowerCase().includes(term) ||
                        d.client.toLowerCase().includes(term) ||
                        d.summary.toLowerCase().includes(term)
                    );
                }
                if (state.dealsFilter.agent && state.dealsFilter.agent !== 'All') {
                    filteredDeals = filteredDeals.filter(d => d.agent === state.dealsFilter.agent);
                }

                // Get unique agents for filter
                const agents = ['All', ...new Set(dealsData.map(d => d.agent))];

                // Helper to render a status block (List View)
                const renderStatusBlock = (status) => {
                    const statusDeals = filteredDeals.filter(d => d.status === status);
                    if (statusDeals.length === 0) return '';

                    const isAiStage = aiStatuses.includes(status);
                    const isUnsorted = status === 'Unsorted';

                    return `
                        <details open class="group">
                            <summary class="font-semibold mb-3 cursor-pointer flex items-center justify-between py-2 select-none rounded-lg hover:bg-gray-50 px-2 -mx-2 transition-colors">
                                <div class="flex items-center gap-2">
                                    <span class="${isAiStage ? 'text-purple-600' : ''} ${isUnsorted ? 'text-gray-600' : ''}">${status}</span>
                                    <span class="text-xs font-normal text-muted-foreground bg-gray-100 px-2 py-0.5 rounded-full">${statusDeals.length}</span>
                                    ${isAiStage ? `<span class="text-xs bg-purple-100 text-purple-700 px-2 py-0.5 rounded-full flex items-center gap-1">ü§ñ AI Zone</span>` : ''}
                                    ${isUnsorted ? `<span class="text-xs bg-gray-100 text-gray-700 px-2 py-0.5 rounded-full flex items-center gap-1">üì• Inbox</span>` : ''}
                                </div>
                                <span class="transform transition-transform group-open:rotate-180 text-gray-400">${ICONS.chevron}</span>
                            </summary>
                            <div class="collapsible-content pb-4 animate-in slide-in-from-top-2 duration-200">
                                <div class="border rounded-lg overflow-hidden shadow-sm ${isAiStage ? 'border-purple-100' : ''} ${isUnsorted ? 'border-gray-200' : ''}">
                                    <div class="overflow-x-auto">
                                        <table class="w-full text-sm text-left">
                                            <thead class="text-xs text-gray-500 uppercase bg-gray-50/50 border-b">
                                                <tr>
                                                    <th class="px-6 py-3 font-medium">Deal</th>
                                                    <th class="px-6 py-3 font-medium">Client</th>
                                                    <th class="px-6 py-3 font-medium">Amount</th>
                                                    <th class="px-6 py-3 font-medium">Agent</th>
                                                    <th class="px-6 py-3 font-medium">Status</th>
                                                </tr>
                                            </thead>
                                            <tbody class="divide-y divide-gray-100">
                                                ${statusDeals.map((deal, index) => `
                                                    <tr class="bg-white hover:bg-gray-50/80 cursor-pointer transition-colors" onclick="window.location.hash = '#deal-details/${deal.id}'">
                                                        <td class="px-6 py-4 font-medium align-middle">
                                                            <div class="text-gray-900">${deal.title}</div>
                                                            ${deal.summary ? `<div class="text-xs text-gray-500 mt-1 line-clamp-1 max-w-xs">${deal.summary}</div>` : ''}
                                                        </td>
                                                        <td class="px-6 py-4 align-middle text-gray-600">${deal.client}</td>
                                                        <td class="px-6 py-4 align-middle font-medium text-gray-900">$${deal.amount.toLocaleString()}</td>
                                                        <td class="px-6 py-4 align-middle">
                                                            <div class="flex items-center gap-2">
                                                                ${deal.agent === 'AI Bot' ? `<span class="w-6 h-6 rounded-full bg-purple-100 flex items-center justify-center text-purple-600">${ICONS.bot}</span>` : `<span class="w-6 h-6 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 text-xs font-bold">${deal.agent.charAt(0)}</span>`}
                                                                <span class="text-sm text-gray-600">${deal.agent}</span>
                                                            </div>
                                                        </td>
                                                        <td class="px-6 py-4 align-middle">
                                                            ${deal.status === 'Ready for Agent' ? `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">üî• Handoff</span>` :
                            deal.offerUrl ? `<a href="${deal.offerUrl}" class="font-medium text-blue-600 hover:underline" onclick="event.stopPropagation()">View Offer</a>` :
                                `<span class="text-gray-400">-</span>`}
                                                        </td>
                                                    </tr>
                                                `).join('')}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </details>
                    `;
                };

                // Helper to render Kanban Column
                const renderKanbanColumn = (status) => {
                    const statusDeals = filteredDeals.filter(d => d.status === status);
                    const isAiStage = aiStatuses.includes(status);

                    return `
                    <div class="flex-shrink-0 w-80 flex flex-col h-full max-h-full bg-gray-100/50 rounded-xl border border-gray-200">
                        <div class="p-3 border-b border-gray-200 flex items-center justify-between bg-gray-50 rounded-t-xl">
                            <div class="flex items-center gap-2">
                                <span class="font-semibold text-sm text-gray-700 ${isAiStage ? 'text-purple-700' : ''} ${status === 'Unsorted' ? 'text-gray-800' : ''}">${status}</span>
                                ${isAiStage ? `<span class="text-[10px] bg-purple-100 text-purple-700 px-1.5 py-0.5 rounded border border-purple-200">AI</span>` : ''}
                                ${status === 'Unsorted' ? `<span class="text-[10px] bg-gray-100 text-gray-700 px-1.5 py-0.5 rounded border border-gray-200">Inbox</span>` : ''}
                            </div>
                            <span class="bg-white border border-gray-200 text-gray-500 text-xs px-2 py-0.5 rounded-full">${statusDeals.length}</span>
                        </div>
                        <div class="flex-1 overflow-y-auto p-2 space-y-2 custom-scrollbar">
                            ${statusDeals.map(deal => `
                                <div onclick="window.location.hash = '#deal-details/${deal.id}'" class="bg-white p-3 rounded-lg border border-gray-200 shadow-sm hover:shadow-md transition-shadow cursor-pointer group">
                                    <div class="flex justify-between items-start mb-2">
                                        <span class="text-xs font-medium text-blue-600 bg-blue-50 px-2 py-0.5 rounded-full line-clamp-1 max-w-[70%]">${deal.client}</span>
                                        <span class="text-xs text-gray-400 font-mono">$${(deal.amount / 1000).toFixed(0)}k</span>
                                    </div>
                                    <h4 class="text-sm font-medium text-gray-900 mb-1 line-clamp-2 group-hover:text-blue-600 transition-colors">${deal.title}</h4>
                                    ${deal.summary ? `<p class="text-xs text-gray-500 line-clamp-2 mb-3">${deal.summary}</p>` : ''}
                                    
                                    <div class="flex items-center justify-between pt-2 border-t border-gray-50 mt-2">
                                        <div class="flex items-center gap-1.5">
                                            ${deal.agent === 'AI Bot' ?
                            `<div class="w-5 h-5 rounded-full bg-purple-100 flex items-center justify-center text-purple-600 text-[10px]">${ICONS.bot}</div>` :
                            `<div class="w-5 h-5 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 text-[10px] font-bold">${deal.agent.charAt(0)}</div>`
                        }
                                            <span class="text-xs text-gray-500 truncate max-w-[80px]">${deal.agent}</span>
                                        </div>
                                        ${deal.status === 'Ready for Agent' ? `<span class="text-[10px] font-bold text-green-600 bg-green-50 px-1.5 py-0.5 rounded">üî• Handoff</span>` : ''}
                                    </div>
                                </div>
                            `).join('')}
                            ${statusDeals.length === 0 ? `<div class="h-20 flex items-center justify-center text-gray-400 text-xs italic border-2 border-dashed border-gray-200 rounded-lg m-1">No deals</div>` : ''}
                        </div>
                    </div>
                `;
                };

                page.innerHTML = `
                    <div class="flex flex-col h-[calc(100vh-100px)]">
                        <!-- Header -->
                        <div class="flex-shrink-0 mb-6 space-y-4">
                            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                                <div>
                                    <h2 class="text-2xl font-bold tracking-tight">Deals Pipeline</h2>
                                    <p class="text-muted-foreground">Manage your deals and track progress.</p>
                                </div>
                                <div class="flex items-center gap-3">
                                    <div class="flex bg-gray-100 p-1 rounded-lg border border-gray-200">
                                        <button onclick="state.dealsViewMode = 'list'; renderDealsPage();" class="px-3 py-1.5 rounded-md text-sm font-medium transition-all ${state.dealsViewMode === 'list' ? 'bg-white text-gray-900 shadow-sm' : 'text-gray-500 hover:text-gray-700'}">
                                            List
                                        </button>
                                        <button onclick="state.dealsViewMode = 'kanban'; renderDealsPage();" class="px-3 py-1.5 rounded-md text-sm font-medium transition-all ${state.dealsViewMode === 'kanban' ? 'bg-white text-gray-900 shadow-sm' : 'text-gray-500 hover:text-gray-700'}">
                                            Kanban
                                        </button>
                                    </div>
                                    <button class="px-4 py-2 bg-gray-900 text-white rounded-lg text-sm font-medium hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-gray-900 transition-all shadow-sm hover:shadow-md">
                                        + Add Deal
                                    </button>
                                </div>
                            </div>

                            <!-- Filters -->
                            <div class="flex flex-wrap items-center gap-3 bg-white p-1">
                                <div class="relative flex-1 min-w-[200px]">
                                    <svg class="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                    </svg>
                                    <input 
                                        type="text" 
                                        placeholder="Search deals..." 
                                        value="${state.dealsFilter.search}"
                                        oninput="state.dealsFilter.search = this.value; renderDealsPage();"
                                        class="w-full pl-9 pr-4 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    >
                                </div>
                                <select 
                                    onchange="state.dealsFilter.agent = this.value; renderDealsPage();"
                                    class="px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white"
                                >
                                    ${agents.map(agent => `<option value="${agent}" ${state.dealsFilter.agent === agent ? 'selected' : ''}>${agent}</option>`).join('')}
                                </select>
                                ${state.currentUserRole !== 'Agent' ? `
                                    <label class="flex items-center gap-2 px-3 py-2 border border-gray-200 rounded-lg bg-white cursor-pointer hover:bg-gray-50 select-none">
                                        <input 
                                            type="checkbox" 
                                            ${state.dealsFilter.showAiStages ? 'checked' : ''} 
                                            onchange="state.dealsFilter.showAiStages = this.checked; renderDealsPage();"
                                            class="rounded text-purple-600 focus:ring-purple-500"
                                        >
                                        <span class="text-sm text-gray-700">Show AI Stages</span>
                                    </label>
                                ` : ''}
                            </div>
                        </div>

                        <!-- Content -->
                        ${state.dealsViewMode === 'list' ? `
                            <div class="flex-1 overflow-y-auto space-y-2 pb-10">
                                ${visibleStatuses.map(status => renderStatusBlock(status)).join('')}
                            </div>
                        ` : `
                            <div class="flex-1 relative min-h-0">
                                <div class="absolute inset-0 overflow-x-auto overflow-y-hidden pb-4">
                                    <div class="flex h-full gap-4 px-1 min-w-max">
                                        ${visibleStatuses.map(status => renderKanbanColumn(status)).join('')}
                                    </div>
                                </div>
                            </div>
                        `}
                    </div>
                `;
            }
            window.renderDealsPage = renderDealsPage;
            function renderDealDetailsPage(dealId) {
                const page = document.getElementById('page-deal-details');
                const deal = dealsData.find(d => d.id === dealId) || dealsData[0];
                const assistantName = state.currentUserRole === 'CEO' ? 'Leonardo' : 'Jessica';

                // Mock data generation for "more info"
                const probability = Math.min(95, 40 + (deal.id * 5) % 50);
                const phone = `+ 971 50 ${1000000 + (deal.id * 12345) % 9000000} `;
                const email = `${deal.client.toLowerCase().replace(/\s+/g, '.')} @example.com`;

                // Status colors
                const getStatusColor = (s) => {
                    if (s.includes('AI')) return 'bg-purple-100 text-purple-700';
                    if (s === 'Closed Won') return 'bg-green-100 text-green-700';
                    if (s === 'Closed Lost') return 'bg-red-100 text-red-700';
                    return 'bg-blue-100 text-blue-700';
                };

                page.innerHTML = `
                <div class="max-w-6xl mx-auto space-y-6 pb-10">
                    <!-- Header -->
                    <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
                        <div>
                            <a href="#deals" class="text-sm text-muted-foreground hover:text-foreground mb-2 inline-flex items-center gap-1 transition-colors">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" /></svg>
                                Back to Pipeline
                            </a>
                            <h1 class="text-3xl font-bold text-gray-900">${deal.title}</h1>
                            <div class="flex items-center gap-3 mt-2">
                                <span class="px-3 py-1 rounded-full text-sm font-medium ${getStatusColor(deal.status)}">
                                    ${deal.status}
                                </span>
                                <span class="text-gray-300">|</span>
                                <span class="font-medium text-gray-600 flex items-center gap-1">
                                    <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>
                                    ${deal.client}
                                </span>
                            </div>
                        </div>
                        <div class="flex gap-3">
                            <button class="px-4 py-2 bg-white border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 shadow-sm transition-all">
                                Edit Deal
                            </button>
                            <button class="px-4 py-2 bg-black text-white rounded-lg text-sm font-medium hover:bg-gray-800 shadow-sm transition-all flex items-center gap-2">
                                <span>Move Stage</span>
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
                            </button>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- Left Column (Main Info) -->
                        <div class="lg:col-span-2 space-y-6">

                            <!-- Client Card -->
                            <div class="bg-white border rounded-xl p-6 shadow-sm">
                                <div class="flex items-center justify-between mb-6">
                                    <h3 class="font-semibold text-lg flex items-center gap-2">
                                        <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V8a2 2 0 00-2-2h-5m-4 0V5a2 2 0 114 0v1m-4 0c0 .884-.896 1.688-2.094 2M10 6c0 .884.896 1.688 2.094 2m4 6h.01M12 12h.01M8 12h.01M12 16h.01M16 16h.01M8 16h.01" /></svg>
                                        Client Details
                                    </h3>
                                    <button class="text-sm text-blue-600 hover:underline">View Profile</button>
                                </div>
                                <div class="flex flex-col sm:flex-row items-start gap-6">
                                    <div class="w-16 h-16 bg-gradient-to-br from-gray-100 to-gray-200 rounded-full flex items-center justify-center text-2xl font-bold text-gray-600 shadow-inner">
                                        ${deal.client.charAt(0)}
                                    </div>
                                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-8 gap-y-6 flex-1 w-full">
                                        <div>
                                            <p class="text-xs uppercase tracking-wider text-gray-500 font-semibold mb-1">Full Name</p>
                                            <p class="font-medium text-gray-900">${deal.client}</p>
                                        </div>
                                        <div>
                                            <p class="text-xs uppercase tracking-wider text-gray-500 font-semibold mb-1">Email Address</p>
                                            <p class="font-medium text-blue-600 hover:underline cursor-pointer flex items-center gap-1">
                                                ${email}
                                            </p>
                                        </div>
                                        <div>
                                            <p class="text-xs uppercase tracking-wider text-gray-500 font-semibold mb-1">Phone Number</p>
                                            <p class="font-medium text-gray-900 flex items-center gap-2">
                                                ${phone}
                                                <button class="p-1 hover:bg-gray-100 rounded text-gray-400 hover:text-gray-600" title="Copy">
                                                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>
                                                </button>
                                            </p>
                                        </div>
                                        <div>
                                            <p class="text-xs uppercase tracking-wider text-gray-500 font-semibold mb-1">Location</p>
                                            <p class="font-medium text-gray-900">Dubai, UAE</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- AI Summary -->
                            <div class="bg-gradient-to-br from-blue-50 to-indigo-50 border border-blue-100 rounded-xl p-6 relative overflow-hidden">
                                <div class="absolute top-0 right-0 p-4 opacity-10">
                                    <svg class="w-32 h-32" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a7 7 0 0 1 7-7V5.73C7.4 5.39 7 4.74 7 4a2 2 0 0 1 2-2h3z" /></svg>
                                </div>
                                <div class="relative z-10">
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center text-white shadow-lg shadow-blue-200">
                                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>
                                        </div>
                                        <h3 class="font-bold text-blue-900 text-lg">AI Insight & Summary</h3>
                                    </div>
                                    <p class="text-gray-800 leading-relaxed bg-white/60 p-4 rounded-lg border border-blue-100/50 backdrop-blur-sm">
                                        ${deal.summary}
                                    </p>

                                    ${deal.feedback ? `
                                            <div class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-4">
                                                <div class="bg-green-50/80 border border-green-100 p-3 rounded-lg">
                                                    <div class="flex items-center gap-2 mb-1">
                                                        <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5"/></svg>
                                                        <span class="text-xs font-bold text-green-700 uppercase">Client Liked</span>
                                                    </div>
                                                    <p class="text-sm text-gray-800">${deal.feedback.liked}</p>
                                                </div>
                                                <div class="bg-red-50/80 border border-red-100 p-3 rounded-lg">
                                                    <div class="flex items-center gap-2 mb-1">
                                                        <svg class="w-4 h-4 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14H5.236a2 2 0 01-1.789-2.894l3.5-7A2 2 0 018.736 3h4.018a2 2 0 01.485.06l3.76.94m-7 10v5a2 2 0 002 2h.095c.5 0 .905-.405.905-.905 0-.714.211-1.412.608-2.006L17 13V4m-7 10h2m5-10h2a2 2 0 012 2v6a2 2 0 01-2 2h-2.5"/></svg>
                                                        <span class="text-xs font-bold text-red-700 uppercase">Concerns</span>
                                                    </div>
                                                    <p class="text-sm text-gray-800">${deal.feedback.disliked}</p>
                                                </div>
                                            </div>
                                        ` : ''}
                                </div>
                            </div>

                            <!-- Chat Log -->
                            <div class="bg-white border rounded-xl shadow-sm overflow-hidden flex flex-col h-[500px]">
                                <div class="p-4 border-b bg-gray-50 flex justify-between items-center">
                                    <h3 class="font-semibold flex items-center gap-2">
                                        <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" /></svg>
                                        Communication History
                                    </h3>
                                    <span class="text-xs text-gray-500 bg-white px-2 py-1 rounded border">Last synced: Just now</span>
                                </div>
                                <div class="flex-1 p-6 space-y-6 overflow-y-auto bg-gray-50/30">
                                    <!-- Mock Chat Items -->
                                    <div class="flex gap-4">
                                        <div class="w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center text-purple-600 text-sm font-bold border-2 border-white shadow-sm flex-shrink-0">AI</div>
                                        <div class="flex flex-col gap-1 max-w-[85%]">
                                            <span class="text-xs text-gray-500 ml-1">${assistantName} ‚Ä¢ 2 days ago</span>
                                            <div class="bg-white border border-gray-200 rounded-2xl rounded-tl-none p-4 text-sm text-gray-800 shadow-sm">
                                                Hello ${deal.client}, I'm ${assistantName}, your dedicated AI assistant. I noticed you were looking at properties in ${deal.title.split(' in ')[1] || 'Dubai'}. How can I help you refine your search today?
                                            </div>
                                        </div>
                                    </div>

                                    <div class="flex gap-4 flex-row-reverse">
                                        <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 text-sm font-bold border-2 border-white shadow-sm flex-shrink-0">
                                            ${deal.client.charAt(0)}
                                        </div>
                                        <div class="flex flex-col gap-1 items-end max-w-[85%]">
                                            <span class="text-xs text-gray-500 mr-1">${deal.client} ‚Ä¢ 2 days ago</span>
                                            <div class="bg-blue-600 text-white rounded-2xl rounded-tr-none p-4 text-sm shadow-md">
                                                Hi! Yes, I'm looking for something spacious. My budget is around $${(deal.amount / 1000000).toFixed(1)}M. I prefer high floors and a sea view if possible.
                                            </div>
                                        </div>
                                    </div>

                                    <div class="flex gap-4">
                                        <div class="w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center text-purple-600 text-sm font-bold border-2 border-white shadow-sm flex-shrink-0">AI</div>
                                        <div class="flex flex-col gap-1 max-w-[85%]">
                                            <span class="text-xs text-gray-500 ml-1">${assistantName} ‚Ä¢ Yesterday</span>
                                            <div class="bg-white border border-gray-200 rounded-2xl rounded-tl-none p-4 text-sm text-gray-800 shadow-sm">
                                                I have found some excellent options that match your criteria perfectly. I've prepared a personalized offer for you. Would you like to schedule a viewing for the ${deal.title}?
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="p-4 border-t bg-white">
                                    <div class="relative">
                                        <input type="text" placeholder="Type a message or internal note..." class="w-full pl-4 pr-12 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:bg-white transition-all">
                                            <button class="absolute right-2 top-1/2 transform -translate-y-1/2 p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors">
                                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" /></svg>
                                            </button>
                                    </div>
                                </div>
                            </div>

                        </div>

                        <!-- Right Column (Sidebar) -->
                        <div class="space-y-6">

                            <!-- Deal Value Card -->
                            <div class="bg-white border rounded-xl p-6 shadow-sm">
                                <p class="text-sm font-medium text-gray-500 mb-1 uppercase tracking-wide">Deal Value</p>
                                <div class="text-4xl font-bold text-gray-900 mb-6">$${deal.amount.toLocaleString()}</div>

                                <div class="space-y-5">
                                    <div>
                                        <div class="flex justify-between text-sm mb-2">
                                            <span class="text-gray-600 font-medium">Win Probability</span>
                                            <span class="font-bold text-gray-900">${probability}%</span>
                                        </div>
                                        <div class="w-full bg-gray-100 rounded-full h-2.5 overflow-hidden">
                                            <div class="bg-gradient-to-r from-green-400 to-green-600 h-full rounded-full shadow-sm" style="width: ${probability}%"></div>
                                        </div>
                                    </div>

                                    <div class="pt-5 border-t border-gray-100">
                                        <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3">Assigned Agent</p>
                                        <div class="flex items-center gap-3 p-2 -mx-2 hover:bg-gray-50 rounded-lg transition-colors cursor-pointer">
                                            <div class="w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-700 font-bold text-sm">
                                                ${deal.agent.charAt(0)}
                                            </div>
                                            <div>
                                                <p class="font-medium text-gray-900">${deal.agent}</p>
                                                <p class="text-xs text-gray-500">Senior Property Consultant</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Next Steps -->
                            <div class="bg-white border rounded-xl p-6 shadow-sm">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="font-semibold">Next Steps</h3>
                                    <span class="text-xs bg-blue-50 text-blue-700 px-2 py-1 rounded font-medium">2 Pending</span>
                                </div>
                                <div class="space-y-3">
                                    <label class="flex items-start gap-3 p-3 rounded-lg border border-gray-100 hover:bg-gray-50 cursor-pointer transition-colors group">
                                        <input type="checkbox" class="mt-1 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                            <span class="text-sm text-gray-700 group-hover:text-gray-900">Send follow-up email regarding ${deal.title}</span>
                                    </label>
                                    <label class="flex items-start gap-3 p-3 rounded-lg border border-gray-100 hover:bg-gray-50 cursor-pointer transition-colors group">
                                        <input type="checkbox" class="mt-1 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                            <span class="text-sm text-gray-700 group-hover:text-gray-900">Schedule viewing for next week</span>
                                    </label>
                                </div>
                                <button class="w-full mt-4 py-2.5 text-sm font-medium text-blue-600 bg-blue-50 rounded-lg hover:bg-blue-100 transition-colors flex items-center justify-center gap-2">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" /></svg>
                                    Add Task
                                </button>
                            </div>

                            <!-- Timeline (Mock) -->
                            <div class="bg-white border rounded-xl p-6 shadow-sm">
                                <h3 class="font-semibold mb-6">Activity Timeline</h3>
                                <div class="relative pl-4 border-l-2 border-gray-100 space-y-8">
                                    <div class="relative">
                                        <div class="absolute -left-[21px] top-1.5 w-3.5 h-3.5 rounded-full bg-blue-500 ring-4 ring-white shadow-sm"></div>
                                        <p class="text-sm font-bold text-gray-900">Deal Created</p>
                                        <p class="text-xs text-gray-500 mt-0.5">2 days ago ‚Ä¢ via Website Inquiry</p>
                                    </div>
                                    <div class="relative">
                                        <div class="absolute -left-[21px] top-1.5 w-3.5 h-3.5 rounded-full bg-purple-500 ring-4 ring-white shadow-sm"></div>
                                        <p class="text-sm font-bold text-gray-900">AI Qualification Completed</p>
                                        <p class="text-xs text-gray-500 mt-0.5">Yesterday ‚Ä¢ Qualified by ${assistantName}</p>
                                    </div>
                                    <div class="relative">
                                        <div class="absolute -left-[21px] top-1.5 w-3.5 h-3.5 rounded-full bg-indigo-500 ring-4 ring-white shadow-sm"></div>
                                        <p class="text-sm font-bold text-gray-900">Agent Assigned</p>
                                        <p class="text-xs text-gray-500 mt-0.5">Today ‚Ä¢ Assigned to ${deal.agent}</p>
                                    </div>
                                </div>
                                <button class="w-full mt-6 text-xs text-gray-500 hover:text-gray-900 font-medium text-center">View Full History</button>
                            </div>

                        </div>
                    </div>
                </div>`;
            }
            function renderPropertiesPage() {
                const page = document.getElementById('page-properties');

                // Helper for property type badges
                const getTypeBadgeColor = (type) => {
                    const colors = {
                        'Villa': 'bg-purple-100 text-purple-700 border-purple-200',
                        'Apartment': 'bg-blue-100 text-blue-700 border-blue-200',
                        'Penthouse': 'bg-amber-100 text-amber-700 border-amber-200',
                        'Townhouse': 'bg-emerald-100 text-emerald-700 border-emerald-200'
                    };
                    return colors[type] || 'bg-gray-100 text-gray-700 border-gray-200';
                };

                page.innerHTML = `
                    <div class="space-y-8 pb-10">
                        <!-- Header Section -->
                        <div class="flex flex-col gap-6">
                            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                                <div>
                                    <h2 class="text-2xl font-bold tracking-tight text-gray-900">Properties</h2>
                                    <p class="text-muted-foreground mt-1">Manage and view your real estate portfolio.</p>
                                </div>
                                <button class="inline-flex items-center justify-center gap-2 px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-800 transition-all shadow-sm hover:shadow-md font-medium text-sm">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
                                    Add Property
                                </button>
                            </div>

                            <!-- Filters Bar -->
                            <div class="bg-white p-4 rounded-xl border border-gray-200 shadow-sm flex flex-col lg:flex-row gap-4 items-center justify-between">
                                <div class="flex flex-col sm:flex-row gap-3 w-full lg:w-auto flex-1">
                                    <!-- Search -->
                                    <div class="relative flex-1 min-w-[240px]">
                                        <svg class="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                        </svg>
                                        <input 
                                            type="text" 
                                            placeholder="Search by name, location..." 
                                            class="w-full pl-10 pr-4 py-2.5 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:bg-white transition-all"
                                        >
                                    </div>
                                    
                                    <!-- Type Filter -->
                                    <select class="px-4 py-2.5 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:bg-white transition-all cursor-pointer min-w-[140px]">
                                        <option value="">All Types</option>
                                        <option value="Villa">Villas</option>
                                        <option value="Apartment">Apartments</option>
                                        <option value="Penthouse">Penthouses</option>
                                    </select>
                                </div>

                                <!-- View Toggle -->
                                <div class="flex bg-gray-100 p-1 rounded-lg border border-gray-200 w-full sm:w-auto">
                                    <button class="flex-1 sm:flex-none px-4 py-1.5 rounded-md text-sm font-medium bg-white text-gray-900 shadow-sm transition-all">All Properties</button>
                                    <button class="flex-1 sm:flex-none px-4 py-1.5 rounded-md text-sm font-medium text-gray-500 hover:text-gray-700 transition-all">My Listings</button>
                                </div>
                            </div>
                        </div>

                        <!-- Properties Grid -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                            ${propertiesData.map((prop, index) => `
                                <div class="group bg-white rounded-2xl border border-gray-200 overflow-hidden hover:shadow-xl hover:-translate-y-1 transition-all duration-300 cursor-pointer animate-in fade-in slide-in-from-bottom-4 fill-mode-backwards" style="animation-delay: ${index * 50}ms" onclick="window.location.hash = '#property-details/${prop.id}'">
                                    <!-- Image Container -->
                                    <div class="relative aspect-[4/3] overflow-hidden">
                                        <img 
                                            src="${prop.image}" 
                                            alt="${prop.name}" 
                                            class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"
                                            loading="lazy"
                                        >
                                        <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-60 group-hover:opacity-70 transition-opacity"></div>
                                        
                                        <!-- Top Badges -->
                                        <div class="absolute top-3 left-3 right-3 flex justify-between items-start">
                                            <span class="px-2.5 py-1 rounded-md text-xs font-semibold bg-white/90 backdrop-blur-md border border-white/20 shadow-sm ${getTypeBadgeColor(prop.type)}">
                                                ${prop.type}
                                            </span>
                                            <button class="p-1.5 rounded-full bg-white/20 backdrop-blur-md hover:bg-white text-white hover:text-red-500 transition-colors" onclick="event.stopPropagation()">
                                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/></svg>
                                            </button>
                                        </div>

                                        <!-- Bottom Info on Image -->
                                        <div class="absolute bottom-3 left-3 right-3 text-white">
                                            <div class="flex items-center gap-1 text-xs font-medium mb-1 opacity-90">
                                                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                                                <span class="truncate">${prop.location}</span>
                                            </div>
                                            <div class="text-xl font-bold tracking-tight">$${prop.price.toLocaleString()}</div>
                                        </div>
                                    </div>

                                    <!-- Content -->
                                    <div class="p-4">
                                        <h3 class="font-semibold text-gray-900 mb-3 line-clamp-1 group-hover:text-blue-600 transition-colors" title="${prop.name}">${prop.name}</h3>
                                        
                                        <!-- Features -->
                                        <div class="grid grid-cols-3 gap-2 py-3 border-t border-gray-100">
                                            <div class="flex flex-col items-center justify-center text-center">
                                                <span class="text-xs text-gray-400 mb-0.5">Beds</span>
                                                <div class="flex items-center gap-1 font-medium text-gray-700 text-sm">
                                                    <svg class="w-3.5 h-3.5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"/></svg>
                                                    ${prop.beds}
                                                </div>
                                            </div>
                                            <div class="flex flex-col items-center justify-center text-center border-l border-gray-100">
                                                <span class="text-xs text-gray-400 mb-0.5">Baths</span>
                                                <div class="flex items-center gap-1 font-medium text-gray-700 text-sm">
                                                    <svg class="w-3.5 h-3.5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 14v3m4-3v3m4-3v3M3 21h18M3 10h18M3 7l9-4 9 4M4 10h16v11H4V10z"/></svg>
                                                    ${prop.baths || Math.max(1, prop.beds - 1)}
                                                </div>
                                            </div>
                                            <div class="flex flex-col items-center justify-center text-center border-l border-gray-100">
                                                <span class="text-xs text-gray-400 mb-0.5">Area</span>
                                                <div class="flex items-center gap-1 font-medium text-gray-700 text-sm">
                                                    <svg class="w-3.5 h-3.5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"/></svg>
                                                    ${prop.area || Math.floor(prop.price / 800).toLocaleString()} <span class="text-[10px]">sqft</span>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Agent Footer -->
                                        <div class="flex items-center justify-between mt-3 pt-3 border-t border-gray-100">
                                            <div class="flex items-center gap-2">
                                                <div class="w-6 h-6 rounded-full bg-gray-100 flex items-center justify-center text-xs font-bold text-gray-600 border border-gray-200">
                                                    ${prop.agent.charAt(0)}
                                                </div>
                                                <span class="text-xs font-medium text-gray-600 truncate max-w-[100px]">${prop.agent}</span>
                                            </div>
                                            <span class="text-[10px] font-medium text-blue-600 bg-blue-50 px-2 py-0.5 rounded-full">Active</span>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                            
                            <!-- Add New Card (Empty State) -->
                            <div class="group border-2 border-dashed border-gray-200 rounded-2xl flex flex-col items-center justify-center p-6 text-center hover:border-blue-400 hover:bg-blue-50/30 transition-all cursor-pointer min-h-[380px]">
                                <div class="w-12 h-12 rounded-full bg-gray-50 group-hover:bg-blue-100 flex items-center justify-center text-gray-400 group-hover:text-blue-600 mb-3 transition-colors">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
                                </div>
                                <h3 class="font-semibold text-gray-900 mb-1">Add New Property</h3>
                                <p class="text-sm text-gray-500 px-4">Upload details and images to list a new property.</p>
                            </div>
                        </div>
                    </div>
                `;
            }
            function renderPropertyDetailsPage(propId) { const page = document.getElementById('page-property-details'); const prop = propertiesData.find(p => p.id === propId) || propertiesData[0]; page.innerHTML = `< div ><a href="#properties" class="text-sm font-medium mb-4 inline-block">&larr; Back to Properties</a><div class="bg-white border rounded-lg overflow-hidden"><img src="${prop.image}" class="w-full h-96 object-cover"><div class="p-6"><h2 class="text-3xl font-bold">${prop.name}</h2><p class="text-muted-foreground mt-1">${prop.location}</p><div class="mt-4 flex gap-8 text-center border-t border-b py-4"><div><p class="text-2xl font-semibold">${prop.beds}</p><p class="text-sm text-muted-foreground">Beds</p></div><div><p class="text-2xl font-semibold">${prop.baths}</p><p class="text-sm text-muted-foreground">Baths</p></div><div><p class="text-2xl font-semibold">${prop.area.toLocaleString()}</p><p class="text-sm text-muted-foreground">Sqft</p></div><div><p class="text-2xl font-semibold">$${prop.price.toLocaleString()}</p><p class="text-sm text-muted-foreground">Price</p></div></div><p class="mt-4 text-gray-700">A stunning luxury villa offering panoramic sea views...</p></div></div></div > `; }
            function renderTasksPage() { const page = document.getElementById('page-tasks'); const tasksByStatus = { Overdue: tasksData.filter(t => t.status === 'Overdue' && !t.completed), Today: tasksData.filter(t => t.status === 'Today' && !t.completed), Upcoming: tasksData.filter(t => t.status === 'Upcoming' && !t.completed), Completed: tasksData.filter(t => t.completed) }; const assistantName = state.currentUserRole === 'CEO' ? 'Leonardo' : 'Jessica'; page.innerHTML = `< div > <div class="flex justify-end items-center mb-4"><button class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-9 px-3 font-medium">Add Task</button></div>${Object.entries(tasksByStatus).map(([status, tasks]) => tasks.length > 0 ? `<div class="mb-6"><h3 class="font-semibold mb-2 text-lg">${status} (${tasks.length})</h3><div class="space-y-2">${tasks.map(task => `<div class="bg-white border rounded-md p-3 flex items-center gap-3"><input type="checkbox" ${task.completed ? 'checked' : ''} class="h-5 w-5"><div class="flex-1"><p class="font-medium ${task.completed ? 'line-through text-muted-foreground' : ''}">${task.title}</p><div class="flex items-center gap-2"><a href="#deal-details/1" class="text-xs text-muted-foreground hover:underline">Related Deal: Villa in Palm Jumeirah</a>${task.createdBy === 'Jessica' ? `<span class="flex items-center gap-1 text-xs text-accent bg-blue-50 px-2 py-0.5 rounded-full" title="Created by ${assistantName}">${ICONS.bot} ${assistantName}</span>` : ''}</div></div><span class="text-sm font-medium ${status === 'Overdue' ? 'text-red-600' : 'text-muted-foreground'}">${task.due}</span></div>`).join('')}</div></div>` : '').join('')}</div > `; }

            function renderSettingsPage() { const page = document.getElementById('page-settings'); page.innerHTML = `< div > <div class="bg-white border rounded-lg"><div class="p-4 border-b"><h3 class="font-semibold">User Management</h3></div><div class="p-6"><button class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-9 px-3 font-medium mb-4">Invite User</button><div class="border rounded-lg overflow-hidden"><table class="w-full text-sm text-left"><thead class="text-xs text-gray-700 uppercase bg-gray-50"><tr><th class="px-6 py-3">Name</th><th class="px-6 py-3">Role</th><th class="px-6 py-3">Status</th><th class="px-6 py-3">Action</th></tr></thead><tbody>${Object.values(users).map(user => `<tr class="bg-white border-b hover:bg-muted"><td class="px-6 py-4 font-medium flex items-center gap-3"><img src="${user.avatar}" class="h-8 w-8 rounded-full">${user.name}</td><td class="px-6 py-4">${user.role}</td><td class="px-6 py-4"><span class="bg-green-100 text-green-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">Active</span></td><td class="px-6 py-4"><a href="#" class="font-medium text-accent hover:underline">Edit</a></td></tr>`).join('')}</tbody></table></div></div></div></div > `; }
            function renderImportsPage() { const page = document.getElementById('page-imports'); page.innerHTML = `< div class="grid gap-6 grid-cols-1 lg:grid-cols-3" ><div class="lg:col-span-1 bg-white border rounded-lg"><div class="p-4 border-b"><h3 class="font-semibold">Import New Leads</h3></div><div class="p-6"><div class="flex items-center justify-center w-full"><label for="dropzone-file" class="flex flex-col items-center justify-center w-full h-64 border-2 border-border border-dashed rounded-lg cursor-pointer bg-muted hover:bg-gray-100"><div class="flex flex-col items-center justify-center pt-5 pb-6"><svg class="w-8 h-8 mb-4 text-gray-500" viewBox="0 0 20 16" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"/></svg><p class="mb-2 text-sm text-gray-500"><span class="font-semibold">Click to upload</span></p><p class="text-xs text-gray-500">CSV, XLS, or XLSX</p></div><input id="dropzone-file" type="file" class="hidden" /></label></div></div></div><div class="lg:col-span-2 bg-white border rounded-lg"><div class="p-4 border-b"><h3 class="font-semibold">Distribute Leads</h3></div><div class="grid grid-cols-3 divide-x border-b"><div class="p-4 text-center"><h4 class="text-sm text-muted-foreground">Total Imported</h4><p class="text-2xl font-bold">${importedLeads.length}</p></div><div class="p-4 text-center"><h4 class="text-sm text-muted-foreground">Assigned</h4><p class="text-2xl font-bold">0</p></div><div class="p-4 text-center"><h4 class="text-sm text-muted-foreground">Unassigned</h4><p id="unassigned-count" class="text-2xl font-bold text-accent">${state.unassignedLeads}</p></div></div><div class="p-6"><form id="distribute-form" class="flex items-end gap-4"><div class="flex-1"><label class="block text-sm font-medium mb-1">Number of Leads</label><input id="distribute-count" type="number" min="1" max="${state.unassignedLeads}" value="${state.unassignedLeads}" class="p-2 border rounded-md w-full"></div><button type="submit" class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-9 px-3 font-medium">Distribute Randomly</button></form></div></div></div > `; }

            function renderOfferPage(token) { const deal = dealsData.find(d => d.id === parseInt(token)) || dealsData[4]; const offerProperties = propertiesData.slice(0, 3); const offerPage = document.getElementById('page-offer'); offerPage.innerHTML = `< div class="max-w-4xl mx-auto p-6 md:p-12" ><header class="text-center mb-12"><svg class="h-10 w-10 mx-auto text-accent mb-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 3L2 9l10 6 10-6-10-6z"/><path d="M2 9l10 6 10-6"/><path d="M2 15l10 6 10-6"/></svg><h1 class="text-3xl font-bold">A Personal Selection for ${deal.client}</h1><p class="text-muted-foreground mt-2">Prepared by Jessica on behalf of Alex Ivanov at AKARIA Portal.</p></header><div class="space-y-8">${offerProperties.map(prop => `<div class="bg-white border rounded-lg overflow-hidden md:flex"><img src="${prop.image}" class="md:w-1/3 h-64 md:h-auto object-cover"><div class="p-6 flex flex-col"><h3 class="text-xl font-semibold">${prop.name}</h3><p class="text-sm text-muted-foreground mt-1">${prop.location}</p><p class="text-gray-700 mt-4 text-sm flex-1">A stunning luxury villa offering panoramic sea views from every room...</p><div class="flex justify-between items-end mt-4"><div><p class="text-lg font-bold text-accent">$${prop.price.toLocaleString()}</p><p class="text-xs text-muted-foreground">${prop.beds} beds ‚Ä¢ ${prop.baths} baths ‚Ä¢ ${prop.area} sqft</p></div></div></div></div>`).join('')}</div><footer class="text-center mt-12 border-t pt-8"><h3 class="text-xl font-semibold">Ready for the next step?</h3><p class="text-muted-foreground mt-2">Let us know if any of these properties catch your eye, and Alex Ivanov will personally get in touch.</p><a href="#dashboard" class="mt-6 inline-block bg-accent text-white font-medium py-3 px-8 rounded-lg text-lg">I'm Interested, Contact Me</a></footer></div > `; }

            // -----------------------------------------------------------------------------
            // 4. CHARTS & LIBRARIES INITIALIZATION
            // -----------------------------------------------------------------------------

            // Shared Chart Configuration
            const chartConfig = {
                colors: {
                    primary: '#2563eb',
                    secondary: '#60a5fa',
                    accent: '#f59e0b',
                    success: '#10b981',
                    danger: '#ef4444',
                    background: ['#2563eb', '#3b82f6', '#60a5fa', '#93c5fd', '#bfdbfe'],
                    border: '#ffffff'
                },
                fonts: {
                    family: "'Inter', sans-serif"
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                usePointStyle: true,
                                padding: 20,
                                font: { family: "'Inter', sans-serif", size: 12 }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(17, 24, 39, 0.9)',
                            titleFont: { family: "'Inter', sans-serif", size: 13, weight: '600' },
                            bodyFont: { family: "'Inter', sans-serif", size: 12 },
                            padding: 10,
                            cornerRadius: 8,
                            displayColors: false
                        }
                    },
                    scales: {
                        x: {
                            grid: { display: false },
                            ticks: { font: { family: "'Inter', sans-serif" } }
                        },
                        y: {
                            beginAtZero: true,
                            grid: { color: '#f3f4f6', borderDash: [4, 4] },
                            ticks: { font: { family: "'Inter', sans-serif" } }
                        }
                    }
                }
            };

            let chartInstances = {};
            function destroyAllCharts() { Object.values(chartInstances).forEach(chart => chart.destroy()); chartInstances = {}; }

            function renderAgentCharts() {
                destroyAllCharts();
                const pipelineCtx = document.getElementById('agentPipelineChart')?.getContext('2d');
                if (pipelineCtx) {
                    // Calculate dynamic data from dealsData
                    const stages = ['New', 'Qualified', 'Offer', 'Negotiation'];
                    const data = stages.map(stage => dealsData.filter(d => d.status.includes(stage) || (stage === 'New' && d.status === 'New Lead')).length);

                    chartInstances.pipeline = new Chart(pipelineCtx, {
                        type: 'bar',
                        data: {
                            labels: stages,
                            datasets: [{
                                label: 'My Deals',
                                data: data,
                                backgroundColor: chartConfig.colors.background.slice(0, 4),
                                borderRadius: 6,
                                barThickness: 40
                            }]
                        },
                        options: {
                            ...chartConfig.options,
                            plugins: { ...chartConfig.options.plugins, legend: { display: false } }
                        }
                    });
                }
            }

            function renderCeoCharts() {
                destroyAllCharts();
                const leadsCtx = document.getElementById('ceoLeadsChart')?.getContext('2d');
                if (leadsCtx) {
                    // Mock data for leads trend (could be calculated if we had dates on all contacts)
                    const weeks = ['W1', 'W2', 'W3', 'W4', 'W5', 'W6', 'W7', 'W8'];
                    const data = [22, 25, 31, 28, 35, 41, 38, 45];

                    chartInstances.leads = new Chart(leadsCtx, {
                        type: 'line',
                        data: {
                            labels: weeks,
                            datasets: [{
                                label: 'New Leads',
                                data: data,
                                borderColor: chartConfig.colors.primary,
                                backgroundColor: 'rgba(37, 99, 235, 0.1)',
                                borderWidth: 3,
                                tension: 0.4,
                                fill: true,
                                pointBackgroundColor: '#fff',
                                pointBorderColor: chartConfig.colors.primary,
                                pointBorderWidth: 2,
                                pointRadius: 4,
                                pointHoverRadius: 6
                            }]
                        },
                        options: {
                            ...chartConfig.options,
                            plugins: { ...chartConfig.options.plugins, legend: { display: false } }
                        }
                    });
                }
            }

            function renderAnalyticsCharts() {
                destroyAllCharts();
                const funnelCtx = document.getElementById('funnelChart')?.getContext('2d');
                const agentCtx = document.getElementById('agentChart')?.getContext('2d');

                if (funnelCtx) {
                    // Calculate funnel data
                    const totalLeads = 100; // Base
                    const qualified = dealsData.filter(d => !['New Lead', 'Disqualified'].includes(d.status)).length + 40; // Mock + real
                    const offers = dealsData.filter(d => ['Offer Sent', 'Negotiation', 'Closed Won'].includes(d.status)).length + 20;
                    const negotiations = dealsData.filter(d => ['Negotiation', 'Closed Won'].includes(d.status)).length + 10;
                    const closed = dealsData.filter(d => d.status === 'Closed Won').length + 5;

                    chartInstances.funnel = new Chart(funnelCtx, {
                        type: 'bar',
                        data: {
                            labels: ['New Leads', 'Qualified', 'Offer Sent', 'Negotiation', 'Closed'],
                            datasets: [{
                                label: 'Conversion',
                                data: [totalLeads, qualified, offers, negotiations, closed],
                                backgroundColor: chartConfig.colors.background,
                                borderRadius: 4,
                                barThickness: 30
                            }]
                        },
                        options: {
                            ...chartConfig.options,
                            indexAxis: 'y',
                            plugins: { ...chartConfig.options.plugins, legend: { display: false } }
                        }
                    });
                }

                if (agentCtx) {
                    // Calculate agent performance
                    const agentPerformance = { 'Alex Ivanov': 0, 'Anna Petrova': 0, 'Other': 0 };
                    dealsData.forEach(d => {
                        if (d.status === 'Closed Won') {
                            if (agentPerformance[d.agent] !== undefined) agentPerformance[d.agent]++;
                            else agentPerformance['Other']++;
                        }
                    });
                    // Add some mock data to make it look good if empty
                    if (Object.values(agentPerformance).every(v => v === 0)) {
                        agentPerformance['Alex Ivanov'] = 12;
                        agentPerformance['Anna Petrova'] = 9;
                        agentPerformance['Other'] = 5;
                    }

                    chartInstances.agent = new Chart(agentCtx, {
                        type: 'doughnut',
                        data: {
                            labels: Object.keys(agentPerformance),
                            datasets: [{
                                data: Object.values(agentPerformance),
                                backgroundColor: [chartConfig.colors.primary, chartConfig.colors.secondary, '#e5e7eb'],
                                borderWidth: 0,
                                hoverOffset: 4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            cutout: '75%',
                            plugins: {
                                legend: {
                                    position: 'bottom',
                                    labels: { usePointStyle: true, padding: 20, font: { family: "'Inter', sans-serif" } }
                                }
                            }
                        }
                    });
                }
            }
            function renderAssistantActivityChart() {
                const activityCtx = document.getElementById('assistantActivityChart')?.getContext('2d');
                if (activityCtx) {
                    // Activity data for the last 7 days
                    const activityData = {
                        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                        datasets: [
                            {
                                label: 'Messages Sent',
                                data: [45, 52, 38, 67, 59, 23, 31],
                                borderColor: '#3b82f6',
                                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                tension: 0.4,
                                fill: true
                            },
                            {
                                label: 'Leads Processed',
                                data: [12, 15, 8, 18, 14, 6, 9],
                                borderColor: '#10b981',
                                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                tension: 0.4,
                                fill: true
                            },
                            {
                                label: 'Meetings Scheduled',
                                data: [3, 4, 2, 6, 5, 1, 2],
                                borderColor: '#f59e0b',
                                backgroundColor: 'rgba(245, 158, 11, 0.1)',
                                tension: 0.4,
                                fill: true
                            }
                        ]
                    };

                    chartInstances.assistantActivity = new Chart(activityCtx, {
                        type: 'line',
                        data: activityData,
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            interaction: {
                                mode: 'index',
                                intersect: false,
                            },
                            plugins: {
                                legend: {
                                    position: 'top',
                                    labels: {
                                        usePointStyle: true,
                                        padding: 20
                                    }
                                },
                                tooltip: {
                                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                    titleColor: 'white',
                                    bodyColor: 'white',
                                    borderColor: 'rgba(255, 255, 255, 0.1)',
                                    borderWidth: 1
                                }
                            },
                            scales: {
                                x: {
                                    display: true,
                                    grid: {
                                        display: false
                                    }
                                },
                                y: {
                                    display: true,
                                    beginAtZero: true,
                                    grid: {
                                        color: 'rgba(0, 0, 0, 0.1)'
                                    }
                                }
                            }
                        }
                    });
                }
            }

            // -----------------------------------------------------------------------------
            // 5. MODAL LOGIC
            // -----------------------------------------------------------------------------
            const modal = { container: document.getElementById('modal-container'), title: document.getElementById('modal-title'), body: document.getElementById('modal-body'), closeBtn: document.getElementById('modal-close-btn') };
            function showModal(title, contentHTML) { modal.title.textContent = title; modal.body.innerHTML = contentHTML; modal.container.dataset.state = 'open'; }
            function hideModal() { modal.container.dataset.state = 'closed'; }
            modal.closeBtn.onclick = hideModal;
            modal.container.onclick = (e) => { if (e.target === modal.container) hideModal(); };

            // -----------------------------------------------------------------------------
            // 6. EVENT LISTENERS & INITIALIZATION
            // -----------------------------------------------------------------------------

            function updateUserUI() {
                const user = users[state.currentUserRole];
                document.getElementById('user-avatar').src = user.avatar;
                document.getElementById('user-name').textContent = user.name;
                document.getElementById('user-role-display').textContent = user.role;
                renderSidebar();
                handleRouting();
                document.querySelectorAll('.role-btn').forEach(btn => {
                    btn.classList.remove('bg-black', 'text-white');
                    if (btn.dataset.role === state.currentUserRole) btn.classList.add('bg-black', 'text-white');
                });
            }

            document.getElementById('role-switcher').addEventListener('click', (e) => { if (e.target.closest('.role-btn')) { state.currentUserRole = e.target.closest('.role-btn').dataset.role; window.location.hash = '#dashboard'; updateUserUI(); } });
            document.getElementById('sidebar-nav-links').addEventListener('click', (e) => { const link = e.target.closest('a'); if (link) { e.preventDefault(); window.location.hash = link.getAttribute('href'); } });

            // Handler for chat button in top bar
            const assistantChatBtn = document.getElementById('assistant-chat-btn');
            if (assistantChatBtn) {
                assistantChatBtn.addEventListener('click', function () {
                    window.location.hash = '#my-assistant';
                });
            }

            document.getElementById('page-content-wrapper').addEventListener('click', e => {
                const link = e.target.closest('a');
                if (link && link.getAttribute('href')?.startsWith('#')) { e.preventDefault(); window.location.hash = link.getAttribute('href'); }

                if (e.target.closest('.focus-tab')) {
                    const tabButton = e.target.closest('.focus-tab');
                    document.querySelectorAll('.focus-tab').forEach(t => t.classList.remove('tab-active', 'text-muted-foreground'));
                    tabButton.classList.add('tab-active'); tabButton.classList.remove('text-muted-foreground');
                    document.querySelectorAll('.focus-tab-content').forEach(c => c.classList.add('page-hidden'));
                    document.getElementById(`tab - ${tabButton.dataset.tab} `).classList.remove('page-hidden');
                }

                if (e.target.closest('.approval-item')) {
                    const offerId = e.target.closest('.approval-item').dataset.offerId;
                    showModal('Review Offer for Elon Musk', `< div class="bg-muted p-4 rounded-md" ><h4 class="font-semibold">Mini-Landing Page Preview</h4><p class="text-sm text-muted-foreground">This is a simulation of the offer page that will be sent.</p><img src="https://picsum.photos/seed/offer${offerId}/800/450" class="mt-4 rounded-md w-full"></div><div class="mt-6 flex justify-end gap-3"><button class="px-4 py-2 text-sm font-medium border rounded-md" onclick="document.getElementById('modal-container').dataset.state = 'closed'">Reject</button><button class="px-4 py-2 text-sm font-medium bg-black text-white rounded-md" onclick="document.getElementById('modal-container').dataset.state = 'closed'">Approve & Send</button></div>`);
                }

                if (e.target.id === 'generate-forecast-btn') {
                    showModal('Q4 Revenue Forecast', `< div class="text-center" ><p class="text-sm text-muted-foreground">Generated by Leonardo</p><p class="text-5xl font-bold my-4">$2.5M - $2.8M</p><p class="text-sm">Based on the current pipeline and a <span class="font-semibold">85% confidence interval</span>.</p></div > `);
                }

                if (e.target.closest('details summary')) {
                    const details = e.target.closest('details');
                    const icon = details.querySelector('summary svg');
                    // Timeout to allow the 'open' attribute to update
                    setTimeout(() => {
                        if (details.open) {
                            icon.style.transform = 'rotate(0deg)';
                        } else {
                            icon.style.transform = 'rotate(-90deg)';
                        }
                    }, 0);
                }

                const distributeForm = e.target.closest('#distribute-form');
                if (distributeForm) {
                    e.preventDefault();
                    const countInput = document.getElementById('distribute-count');
                    const count = parseInt(countInput.value);
                    if (count > 0 && count <= state.unassignedLeads) {
                        state.unassignedLeads -= count;
                        alert(`${count} leads have been randomly distributed to agents and are now being processed by their AI assistants.`);
                        renderImportsPage();
                    } else {
                        alert('Please enter a valid number of leads to distribute.');
                    }
                }
            });



            document.getElementById('mobile-menu-btn').addEventListener('click', () => { document.getElementById('sidebar').classList.toggle('hidden'); });
            window.addEventListener('hashchange', handleRouting);
            updateUserUI();
        });
    </script>

    <!-- shadcn/ui Components -->
    <script src="components/ui/button.js"></script>
    <script src="components/ui/badge.js"></script>
    <script src="components/ui/input.js"></script>
    <script src="components/ui/select.js"></script>
    <script src="components/ui/card.js"></script>
    <script src="components/ui/table.js"></script>

    <!-- Contacts Components -->




</body>

</html>